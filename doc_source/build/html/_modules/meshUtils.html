

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>meshUtils &mdash; ismcpak 0.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="ismcpak 0.0.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">ismcpak 0.0.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for meshUtils</h1><div class="highlight"><pre>
<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">glob</span><span class="o">,</span> <span class="nn">fnmatch</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pylab</span> <span class="kn">as</span> <span class="nn">pyl</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">matplotlib.widgets</span> <span class="kn">import</span> <span class="n">Slider</span><span class="p">,</span> <span class="n">Button</span><span class="p">,</span> <span class="n">RadioButtons</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="kn">as</span> <span class="nn">cm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span>   <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>

<span class="kn">from</span> <span class="nn">time</span>  <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">mesh</span>  <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">mylib.utils.ndmesh</span> <span class="kn">import</span> <span class="n">ndmesh</span>
<span class="kn">from</span> <span class="nn">mylib.utils.misc</span>   <span class="kn">import</span> <span class="n">fetchNestedDtypeValue</span>
<span class="kn">from</span> <span class="nn">ismUtils</span>   <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">radex</span>      <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">scipy</span>      <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">import</span> <span class="nn">chemicalNetwork</span>

<div class="viewcode-block" id="meshArxv"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv">[docs]</a><span class="k">class</span> <span class="nc">meshArxv</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; this class generates and manipulates archives of PDR meshes.</span>

<span class="sd">     :param bool readDb: if this is set, the database is read during initialization.</span>
<span class="sd">      </span>
<span class="sd">     :param bool set_defaults: if this is passed as a keyword, self.set_default attributes and self.set_grid_axes_quantity_values are called upon intialization.</span>
<span class="sd">       </span>
<span class="sd">     :param bool no_init_from_run_parms: if this is passed as a keyword, nothing is initialized from used_parms.pkl.                </span>

<span class="sd">     FILES AND THEIR FORMATS: by default, the prefix name of the individual mesh files is assumed to be</span>
<span class="sd">      mesh.dat-id-xxxxxx</span>
<span class="sd">     </span>
<span class="sd">     The mesh database files are assumed to have the same prefix, for example, if the database file provided is foo, then this routine will assume (or write).</span>
<span class="sd">       </span>
<span class="sd">        - foo.info, foo.db</span>
<span class="sd">         </span>
<span class="sd">     for now the database can be stored into a single file and not split into</span>
<span class="sd">     multiple files.  </span>
<span class="sd">     </span>
<span class="sd">     the database for the meshes is constructed of two binary files:</span>
<span class="sd">     </span>
<span class="sd">         - foo.info : holding all the information about the meshes, locations and parameters</span>
<span class="sd">         - foo.db   : holds the data for all the meshes</span>
<span class="sd">       </span>
<span class="sd">     the info file has the following structure :</span>
<span class="sd">        </span>
<span class="sd">       - version number    : int32 int32 int32</span>
<span class="sd">       - nMeshes           : int32 </span>
<span class="sd">       - meshes info array : meshInfoArrayFormat (see also the method)</span>
<span class="sd">         ( nMeshes, 1)          </span>

<span class="sd">          the entries of the dtype are</span>
<span class="sd">           </span>
<span class="sd">            - mesh number     ( int64 ) :</span>
<span class="sd">            - data file index ( int64 ) : i.e in which .db file the mesh is located</span>
<span class="sd">            - offset ( int64 ) : the offset in bytes from the beginning of the file where the mesh is located</span>
<span class="sd">            - nSteps ( int64 ) : the number of slabs in the mesh</span>
<span class="sd">            - nSpecs ( int64 ) : the number of species in the mesh                                   .</span>
<span class="sd">                        </span>
<span class="sd">      the .db files have the following structure:</span>
<span class="sd">      </span>
<span class="sd">         - mesh_1 ( mesh dtype )</span>
<span class="sd">         - checkNum_1 ( int64 )</span>
<span class="sd">         - mesh_2 ( mesh dtype )</span>
<span class="sd">         - checkNum_2 ( int64 )</span>

<span class="sd">      For a mesh number i, the checkNum_i should be the same as the i^th entry </span>
<span class="sd">      in the info array offset...i.e chechNum = infoAll[i][&#39;info&#39;][2] </span>
<span class="sd">      </span>
<span class="sd">      features:</span>
<span class="sd">      </span>
<span class="sd">          - cliking on the panel of the temperature, sets the Av and gasT to the chemical</span>
<span class="sd">            network of the self.mshTmp object (which is the same as self.chemNet). Once</span>
<span class="sd">            those are set, the reactions can be examined, for example :</span>
<span class="sd">              </span>
<span class="sd">            .. code-block:: python</span>
<span class="sd">              </span>
<span class="sd">                ids = net.filter_reactions(withType=&#39;CP&#39;, </span>
<span class="sd">                                           show=True,  </span>
<span class="sd">                                           fmt=&#39;id type rxn abg cst rate&#39;, </span>
<span class="sd">                                           sort = True)</span>
<span class="sd">          </span>
<span class="sd">      :TODO: modify such that it can handle models with one slab only (the surface slab).</span>
<span class="sd">      </span>
<span class="sd">      see test_writeReadArxv.py for an example</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupLogger</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;The logging object which will be used to output stuff to stdout&quot;&quot;&quot;</span>

        <span class="c"># attributes</span>
        <span class="k">if</span> <span class="s">&#39;dirPath&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;dirPath&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="sd">&quot;&quot;&quot;path to the directory which contains all the database info and data&quot;&quot;&quot;</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span>    <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot; np.long64 : number of meshes in the database (this is now as 1x1 array, convert it just into an np.int32 scalar&quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ver</span>        <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot; np.int32 array [3] version number of the database data&quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">meshes</span>     <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;A list of all the meshes of &#39;mesh&#39; dtypes (see mesh.py).</span>
<span class="sd">        </span>
<span class="sd">           For a mesh of at index &#39;i&#39; in</span>
<span class="sd">            </span>
<span class="sd">               self.meshes[i]</span>
<span class="sd">               </span>
<span class="sd">           The corresponding info in the header are accessed as follows :</span>
<span class="sd">            </span>
<span class="sd">             - self.infoAll[i][&#39;parms&#39;][0]) which should be the same as self.meshes[i][&#39;hdr&#39;][&#39;G0&#39;] </span>
<span class="sd">             - self.infoAll[i][&#39;parms&#39;][1]) which should be the same as self.meshes[i][&#39;hdr&#39;][&#39;nGas&#39;]</span>
<span class="sd">             - self.infoAll[i][&#39;parms&#39;][2]) which should be the same as self.meshes[i][&#39;hdr&#39;][&#39;gammaMech&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span>    <span class="o">=</span> <span class="bp">None</span> 
        <span class="sd">&quot;&quot;&quot;A numpy ndarray of dtype arxvHdrDtype (see below) which contains the info</span>
<span class="sd">           (headers) about all the meshes each entry in this array contains two things,</span>
<span class="sd">           information about the mesh and the parameters of the mesh. For example</span>
<span class="sd">           the elements x in self.infoAll[x] has the following contents : </span>
<span class="sd">           self.infoAll[x][&#39;info&#39;][0]   mesh number\n </span>
<span class="sd">           self.infoAll[x][&#39;info&#39;][1]   0 ( for now)\n</span>
<span class="sd">           self.infoAll[x][&#39;info&#39;][2]   offset from the start of file\n</span>
<span class="sd">           self.infoAll[x][&#39;info&#39;][3]   number of steps in the mesh\n</span>
<span class="sd">           self.infoAll[x][&#39;info&#39;][4]   number of species\n</span>
<span class="sd">         </span>
<span class="sd">           self.infoAll[x][&#39;parms&#39;][0]  G0\n</span>
<span class="sd">           self.infoAll[x][&#39;parms&#39;][1]  nGas\n</span>
<span class="sd">           self.infoAll[x][&#39;parms&#39;][2]  gammaMech\n</span>
<span class="sd">           self.infoAll[x][&#39;parms&#39;][3]  0.0, NOT USED\n</span>
<span class="sd">           self.infoAll[x][&#39;parms&#39;][4]  0.0  NOT USED\n</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c">#---------------------------radex data storage attributes-----------------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verRadex</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;a 3 element np.int32 array holding the version of the radex database currently in use.&quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">currentRadexDb</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;A string which holds the species name of the current radex database being used.&quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">infoAllRadex</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;A numpy ndarray of length self.nMeshes of dtype returned by self.arxvRadexHdrFormat which</span>
<span class="sd">           holds the number of transitions computed for the mesh it corresponds to in self.meshes and</span>
<span class="sd">           self.infoAll. A value of zero means that there were was valid output from radex. The contents</span>
<span class="sd">           of each elements in the array are (describing the dtype entries):</span>
<span class="sd">        </span>
<span class="sd">           .. code-block:: python</span>
<span class="sd">            </span>
<span class="sd">             self.infoAllRadex[x][&#39;info&#39;][0]   mesh number </span>
<span class="sd">             self.infoAllRadex[x][&#39;info&#39;][1]   number of transitions (0 =&gt; no radex data for this mesh)</span>
<span class="sd">             self.infoAllRadex[x][&#39;info&#39;][2]   offset from the start of file (computed and set only when the databse will be written, 0 otherwise)</span>
<span class="sd">             self.infoAllRadex[x][&#39;info&#39;][3]   warning code # holds radex.status after radex runs for the model</span>
<span class="sd">             self.infoAllRadex[x][&#39;info&#39;][4]   error code</span>
<span class="sd">         </span>
<span class="sd">             self.infoAllRadex[x][&#39;parms&#39;][0]  G0  (same as the entries in self.infoAll)</span>
<span class="sd">             self.infoAllRadex[x][&#39;parms&#39;][1]  nGas</span>
<span class="sd">             self.infoAllRadex[x][&#39;parms&#39;][2]  gammaMech</span>
<span class="sd">             self.infoAllRadex[x][&#39;parms&#39;][3]  0.0, NOT USED</span>
<span class="sd">             self.infoAllRadex[x][&#39;parms&#39;][4]  0.0  NOT USED</span>


<span class="sd">           .. note:: the transitions are stored even if there are warnings when running radex. So </span>
<span class="sd">            take good care when analyzing the data. The info of this attribute is stored into </span>
<span class="sd">            infoAllRadex.db.info.(specStr). Each specie will have its own .db.info.... file</span>
<span class="sd">            and a corresponding .db.(specStr) file which will hold all the data in self.meshesRadex.</span>
<span class="sd">        &quot;&quot;&quot;</span>
                    
        <span class="bp">self</span><span class="o">.</span><span class="n">meshesRadex</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;A list holding all the info dumped by radex for each model. Each entry in the list is an ndarray</span>
<span class="sd">         of dtype :data:`radex.radex.transitionDtype`. The keys in each transition dtype are listed in </span>
<span class="sd">         :data:`radex.radex.transitions` . </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">radexDbs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="sd">&quot;&quot;&quot;A dictionary holding the radex databases read so far. Each entry in the</span>
<span class="sd">        dictionary is a dictionary of two keys : &#39;infoAll&#39; and &#39;meshes&#39;. For example, </span>
<span class="sd">        this could hold the databases for CO, HCN and HNC. Those can be mannualy</span>
<span class="sd">        to self.meshesRadex and self.infoAllRadex via :</span>
<span class="sd">        </span>
<span class="sd">        .. code-block:: python</span>
<span class="sd">        </span>
<span class="sd">            #setting the CO radex database</span>
<span class="sd">            self.meshesRadex  = self.radexDbs[&#39;CO&#39;][&#39;meshes&#39;]</span>
<span class="sd">            self.infoAllRadex = self.radexDbs[&#39;CO&#39;][&#39;infoAll&#39;]</span>
<span class="sd">            </span>
<span class="sd">            #setting the HCN radex database</span>
<span class="sd">            self.meshesRadex  = self.radexDbs[&#39;HCN&#39;][&#39;meshes&#39;]</span>
<span class="sd">            self.infoAllRadex = self.radexDbs[&#39;HCN&#39;][&#39;infoAll&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#-------------------------------------------------------------------------------------</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_qx</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;A list pointing to the quantity in the mesh.data dtype to be used for the x-axsi&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;the values for all the meshes corresponding to qx&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_qy</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;same as qx but for the y axis&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;same as qx but for the y axis&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_qz</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;same as qx but for the z axis&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;same as qx but for the z axis&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_z_unique</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;holds the unique values of grid_z&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nDbFiles</span>   <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot; numpy.int32 number of database files&quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">chemNet</span>    <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot; object of class type chemicalNetwork holds info about the chemical network used&quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="s">&#39;plotRanges&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;plotRanges&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;The ranges which will be used for displaying the x,y,z dimesntions for grid_x,yz&quot;&quot;&quot;</span>
        
        <span class="c"># variables used for plotting</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pltGmSec</span>    <span class="o">=</span> <span class="bp">None</span> <span class="c">#: the value of the section in Gmech selected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grds</span>        <span class="o">=</span> <span class="bp">None</span> <span class="c">#: 2x2 ndmesh array object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pltRadex</span>    <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resPltGrids</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="c">#attributes used for storing the interpolation functions from which </span>
        <span class="c">#the 2D grids to be displayed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grdInterp_f</span>           <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">abunGridInterp_f</span>      <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colDensGridInterp_f</span>   <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intensityGridInterp_f</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">parms</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="sd">&quot;&quot;&quot;all the keywords used in setting up the database and running it.&quot;&quot;&quot;</span>
        
        <span class="sd">&quot;&quot;&quot;resolution of the interpolated grids&quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="s">&#39;metallicity&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_metallicity</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;metallicity&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metallicity</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span>   <span class="o">=</span> <span class="bp">None</span>
        <span class="c">#--------------------------GEN AND PLOT RADEX CURVES---------------------------------</span>
        <span class="k">if</span> <span class="s">&#39;radex&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;use&#39;</span><span class="p">]:</span>
                <span class="c">#making the instance            </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setup_default_radex_instance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;a mesh object which is used to store single mesh data just for plotting purposes&quot;&quot;&quot;</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parms_used_in_PDR_models</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;a dictionary holding the parameters used in modeling the PDRs.  This is read</span>
<span class="sd">        from self.dirPath/used_parms.pkl&quot;&quot;&quot;</span> 
        
        <span class="c">#reading the used_parms.pkl file (if found) and setting the vaues read from it</span>
        <span class="k">if</span> <span class="s">&#39;no_init_from_run_parms&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read_used_parms_used_in_PDR_models</span><span class="p">()</span>

        <span class="k">if</span> <span class="s">&#39;readDb&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;readDb&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readDb</span><span class="p">(</span> <span class="n">check</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="s">&#39;set_defaults&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;set_defaults&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_default_attributes</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_grid_axes_quantity_values</span><span class="p">()</span>
        
        <span class="c">#setting up the auxiliary attributes if the parms are available</span>
        <span class="c">#self.mshTmp and self.radexObj</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemNet</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">metallicity</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span> <span class="o">=</span> <span class="n">mesh</span><span class="p">(</span><span class="n">chemNet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemNet</span><span class="p">,</span> <span class="n">metallicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metallicity</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">read_used_parms_used_in_PDR_models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fpath_parms_used</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span><span class="p">,</span><span class="s">&#39;used_parms.pkl&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">fpath_parms_used</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;setting metallicity and chemical network from : </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fpath_parms_used</span><span class="p">)</span>
            <span class="c">#loading the parameters</span>
            <span class="n">parms</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">fpath_parms_used</span><span class="p">))</span>
            <span class="c">#setting the attributes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metallicity</span> <span class="o">=</span> <span class="n">parms</span><span class="p">[</span><span class="s">&#39;metallicity&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setupChemistry</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;chemistry&#39;</span><span class="p">])</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">parms_used_in_PDR_models</span> <span class="o">=</span> <span class="n">parms</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;no used_parms.pkl file found : </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fpath_parms_used</span><span class="p">)</span> 
    
<div class="viewcode-block" id="meshArxv.construct"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.construct">[docs]</a>    <span class="k">def</span> <span class="nf">construct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meshNamePrefix</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">writeDb</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construc the database anad write the .db files. If the meshNamePrefix </span>
<span class="sd">            is not supplied all the files in :data:`dirPath` are assumed to be </span>
<span class="sd">            data files and all of them are put in the database. The files with </span>
<span class="sd">            matching name prefix are looked for resusively in the &#39;meshes&#39; directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">meshNamePrefix</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">meshNamePrefix</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        
        <span class="n">sourceDir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span><span class="p">,</span> <span class="s">&#39;meshes&#39;</span><span class="p">)</span>
        <span class="n">lookFor</span>   <span class="o">=</span> <span class="n">meshNamePrefix</span> <span class="o">+</span> <span class="s">&#39;*&#39;</span>
        
        <span class="c"># getting the names of the meshes in that dir (recursively)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">root</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">sourceDir</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">fnmatch</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">filenames</span><span class="p">,</span> <span class="n">lookFor</span><span class="p">):</span>
                <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
        
        <span class="c"># setting variable for the </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;found </span><span class="si">%s</span><span class="s"> meshes&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">))</span>

        <span class="c"># defining the array holding the info about all the meshes</span>
        <span class="c"># and their location in the database ..etc..</span>
        <span class="n">arxvHdrDtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">arxvHdrFormat</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">infoAll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">arxvHdrDtype</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meshes</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c"># reading the individual mesh files and writing the files into .db file(s)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span> <span class="p">):</span>
    
            <span class="n">fName</span> <span class="o">=</span> <span class="n">files</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
            <span class="c"># reading a mesh</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">mesh</span><span class="p">(</span><span class="n">fName</span><span class="p">)</span>
            <span class="n">mData</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">getData</span><span class="p">()</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mData</span><span class="p">)</span>
        
            <span class="c"># filling the corresponding field in the header array</span>
            <span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="c"># mesh number </span>
            <span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># data file index</span>
            <span class="c">##infoAll[i][&#39;info&#39;][2] is filled in self.writeDb()</span>
            <span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">mData</span><span class="p">[</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;nSteps&#39;</span><span class="p">]</span>  
            <span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">mData</span><span class="p">[</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;nSpecs&#39;</span><span class="p">]</span>
            <span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">mData</span><span class="p">[</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;version&#39;</span><span class="p">]</span>
     
            <span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mData</span><span class="p">[</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;G0&#39;</span><span class="p">]</span>
            <span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mData</span><span class="p">[</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;nGas&#39;</span><span class="p">]</span>
            <span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">mData</span><span class="p">[</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;gammaMech&#39;</span><span class="p">]</span>
            <span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
            
            <span class="k">del</span> <span class="n">m</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span> <span class="o">/</span> <span class="mi">100</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;proccessed </span><span class="si">%d</span><span class="s"> meshes...&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span> 
            
        <span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span> <span class="o">=</span> <span class="n">infoAll</span>
        
        <span class="k">if</span> <span class="n">writeDb</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writeDb</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="meshArxv.writeDb"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.writeDb">[docs]</a>    <span class="k">def</span> <span class="nf">writeDb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dirName</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; writes the mesh.db and mesh.db.ino into the dir dirName. By default the files are</span>
<span class="sd">        written to the directorey self.dirName, unless a diffrent path is specified via</span>
<span class="sd">        the keyword dirName.</span>
<span class="sd">        </span>
<span class="sd">        :param string dirName: The directory where to write the database files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">dirName</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">dirName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span>
        
        <span class="c"># writing the mesh to the database file</span>
        <span class="n">dbDataFObj</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="n">dirName</span> <span class="o">+</span> <span class="s">&#39;meshes.db&#39;</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span> <span class="n">dbDataFObj</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbDataFObj</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>  <span class="c"># offset from the start of file</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span><span class="n">dbDataFObj</span><span class="p">)</span>
        <span class="n">dbDataFObj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="c"># writing the db info into a file</span>
        <span class="n">dbInfoFObj</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="n">dirName</span> <span class="o">+</span> <span class="s">&#39;meshes.db.info&#39;</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ver</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span> <span class="n">dbInfoFObj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span> <span class="n">dbInfoFObj</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span> <span class="n">dbInfoFObj</span> <span class="p">)</span>
        <span class="n">dbInfoFObj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;wrote successfully database files : </span><span class="se">\n</span><span class="s">  </span><span class="si">%s</span><span class="se">\n</span><span class="s">  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dbInfoFObj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dbDataFObj</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>        
        </div>
<div class="viewcode-block" id="meshArxv.readDb"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.readDb">[docs]</a>    <span class="k">def</span> <span class="nf">readDb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; reads the database and assigns the appropritate attributes (document)</span>
<span class="sd">            </span>
<span class="sd">            :param check: if this is set (to any value) the self.checkIntegrity() is called.</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        
        <span class="n">dbInfoFObj</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span> <span class="o">+</span> <span class="s">&#39;meshes.db.info&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
        <span class="n">dbDataFObj</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span> <span class="o">+</span> <span class="s">&#39;meshes.db&#39;</span>     <span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ver</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span> <span class="n">dbInfoFObj</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
        <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span> <span class="n">dbInfoFObj</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">arxvHdrDtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">arxvHdrFormat</span><span class="p">()</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span> <span class="n">dbInfoFObj</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">arxvHdrDtype</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">)</span>

        <span class="c"># reading the meshes in database into a list </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meshes</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">):</span>
            
            <span class="n">mDummy</span> <span class="o">=</span> <span class="n">mesh</span><span class="p">()</span>
            
            <span class="n">nSteps</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">nSpecs</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
            <span class="n">meshVer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]</span>
            
            <span class="n">thisMeshDtype</span> <span class="o">=</span> <span class="n">mDummy</span><span class="o">.</span><span class="n">constructMeshDtype</span><span class="p">(</span><span class="n">nSpecs</span><span class="p">,</span> <span class="n">nSteps</span><span class="p">,</span> <span class="n">meshVer</span><span class="p">)</span>
            <span class="n">thisMeshData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span> <span class="n">dbDataFObj</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">thisMeshDtype</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">thisMeshData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>                
            <span class="n">checkNum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span> <span class="n">dbDataFObj</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">checkNum</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">strng</span>  <span class="o">=</span> <span class="s">&#39;Error : checkpoint numbers do not match : database may be corrupt.</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="n">strng</span> <span class="o">+=</span> <span class="s">&#39;read = </span><span class="si">%d</span><span class="s">, expected = </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">checkNum</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">strng</span> <span class="o">+=</span> <span class="s">&#39; when reading mesh </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">i</span>                
                <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="n">strng</span><span class="p">)</span>
                    
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;read successfully database files : </span><span class="se">\n</span><span class="s">  </span><span class="si">%s</span><span class="se">\n</span><span class="s">  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dbInfoFObj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dbDataFObj</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">checkIntegrity</span><span class="p">()</span>
            </div>
<div class="viewcode-block" id="meshArxv.writeDbRadex"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.writeDbRadex">[docs]</a>    <span class="k">def</span> <span class="nf">writeDbRadex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dirName</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; writes the radex meshesRadex.db and meshesRadex.db.info files.  By default the files are</span>
<span class="sd">        written to the directorey self.dirName. , unless a diffrent path is specified via</span>
<span class="sd">        the keyword dirName. For each mesh, a block consists of : [log10_G0, log10_nGas, log10_gammaMech,],</span>
<span class="sd">        transitionData, filePosition....etc...</span>
<span class="sd">        if transitionData is none, then transitionData is not written in the block, but the rest of the</span>
<span class="sd">        block is written.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        :param string dirName: The directory where to write the database files.</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="k">if</span> <span class="n">dirName</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">dirName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span>
        
        <span class="c"># writing the mesh to the database file</span>
        <span class="n">dbDataFObj</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="n">dirName</span> <span class="o">+</span> <span class="s">&#39;meshesRadex.db.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;specStr&#39;</span><span class="p">],</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span> <span class="p">):</span>
            
            <span class="c">#writing the mesh parameters before writing the transition data (extra data integrirty check)</span>
            <span class="n">thisMeshParms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;G0&#39;</span><span class="p">],</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;nGas&#39;</span><span class="p">],</span>
                                      <span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;gammaMech&#39;</span><span class="p">]],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
            <span class="n">thisMeshParms</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span> <span class="n">dbDataFObj</span> <span class="p">)</span>

            <span class="c">#writing the transition info to the transiotions db file</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshesRadex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c">#writing the transition data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">meshesRadex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span> <span class="n">dbDataFObj</span> <span class="p">)</span>
                <span class="c">#filling the necessary values in infoAllRadex</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">dbDataFObj</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>  <span class="c"># offset from the start of file</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="c">#writing the offset so far from the begining of the .db file</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span><span class="n">dbDataFObj</span><span class="p">)</span>

        <span class="n">dbDataFObj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c"># writing the db info into a file</span>
        <span class="n">dbInfoFObj</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;dirPath&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;meshesRadex.db.info.&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;specStr&#39;</span><span class="p">],</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verRadex</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span> <span class="n">dbInfoFObj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span> <span class="n">dbInfoFObj</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infoAllRadex</span><span class="o">.</span><span class="n">tofile</span><span class="p">(</span> <span class="n">dbInfoFObj</span> <span class="p">)</span>
        <span class="n">dbInfoFObj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;wrote successfully the radex database files : </span><span class="se">\n</span><span class="s">  </span><span class="si">%s</span><span class="se">\n</span><span class="s">  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dbInfoFObj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dbDataFObj</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="meshArxv.readDbRadex"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.readDbRadex">[docs]</a>    <span class="k">def</span> <span class="nf">readDbRadex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specStr</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reads the database suffixed by specStr (i.e meshesRadex.db.(specStr)and assigns the</span>
<span class="sd">           appropritate attributes (document) and assigns the read data to self.meshesRadex and</span>
<span class="sd">           self.infoAllRadex. </span>
<span class="sd">            </span>
<span class="sd">           :param bool check: if this is set (to any value) the self.checkIntegrity() is called.</span>
<span class="sd">           :param string specStr: the string of the specie whose database is to be read.</span>
<span class="sd">           </span>
<span class="sd">           .. warning:: the keyword specStr is not functional yet.</span>
<span class="sd">           .. note:: before calling this mehtod, an instance of the radex class should be     </span>
<span class="sd">               assigned to self.radexObj. </span>
<span class="sd">        &quot;&quot;&quot;</span> 
        
        <span class="c">#reading the database only if it is not already read. If it is read, it would</span>
        <span class="c">#have a key in radexDbs</span>
        <span class="k">if</span> <span class="n">specStr</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">radexDbs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">dbInfoFObj</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span> <span class="o">+</span> <span class="s">&#39;meshesRadex.db.info.&#39;</span> <span class="o">+</span> <span class="n">specStr</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
            <span class="n">dbDataFObj</span> <span class="o">=</span> <span class="nb">file</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span> <span class="o">+</span> <span class="s">&#39;meshesRadex.db.&#39;</span> <span class="o">+</span> <span class="n">specStr</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span>
    
            <span class="bp">self</span><span class="o">.</span><span class="n">verRadex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span> <span class="n">dbInfoFObj</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verRadex</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verRadex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
            <span class="n">nMeshes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span> <span class="n">dbInfoFObj</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span> <span class="o">!=</span> <span class="n">nMeshes</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;number of meshes in radex database is different from that of the meshes database&#39;</span><span class="p">)</span>
            
            <span class="n">arxvRadexHdrDtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">arxvRadexHdrFormat</span><span class="p">()</span> <span class="p">)</span>
            <span class="n">infoAllRadex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span> <span class="n">dbInfoFObj</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">arxvRadexHdrDtype</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">)</span>
            <span class="n">dbInfoFObj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            
            <span class="c"># reading the meshes in database into a list </span>
            <span class="n">meshesRadex</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">radexTransitionsDtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">generateTransitionDtype</span><span class="p">()</span>
    
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">):</span>
    
                <span class="n">meshParms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span> <span class="n">dbDataFObj</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
    
                <span class="c">#overwriting the read parms into the infoAllRadex[&#39;parms&#39;]</span>
                <span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">meshParms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c">#G0</span>
                <span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">meshParms</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c">#nGas</span>
                <span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">meshParms</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="c">#gammaMech</span>
                             
                <span class="c"># the number of transitions save in the database for this mesh</span>
                <span class="n">nTransitions</span> <span class="o">=</span> <span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                
                <span class="k">if</span> <span class="n">nTransitions</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c">#reading the transition data for this mesh </span>
                    <span class="n">thisMeshRadexData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span> <span class="n">dbDataFObj</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">radexTransitionsDtype</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">nTransitions</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">thisMeshRadexData</span> <span class="o">=</span> <span class="bp">None</span>
                    
                <span class="c">#reading the check flag, which is the position in bytes in the database</span>
                <span class="n">checkNum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span> <span class="n">dbDataFObj</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    
                <span class="k">if</span> <span class="n">checkNum</span> <span class="o">!=</span> <span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="n">strng</span>  <span class="o">=</span> <span class="s">&#39;Error : While reading mesh </span><span class="si">%d</span><span class="s"> </span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">i</span>
                    <span class="n">strng</span> <span class="o">+=</span> <span class="s">&#39;           Error : checkpoint numbers do not match : radex database may be corrupt.</span><span class="se">\n</span><span class="s">&#39;</span>
                    <span class="n">strng</span> <span class="o">+=</span> <span class="s">&#39;           Error : read = </span><span class="si">%d</span><span class="s">, expected = </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">checkNum</span><span class="p">,</span> <span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
                    <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="n">strng</span><span class="p">)</span>
    
                <span class="c">#self.meshes.append( thisMeshRadexData[0] )                </span>
                <span class="n">meshesRadex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">thisMeshRadexData</span> <span class="p">)</span>                
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;read successfully radex database files : </span><span class="se">\n</span><span class="s">  </span><span class="si">%s</span><span class="se">\n</span><span class="s">  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">dbInfoFObj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dbDataFObj</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    
            <span class="bp">self</span><span class="o">.</span><span class="n">infoAllRadex</span> <span class="o">=</span> <span class="n">infoAllRadex</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meshesRadex</span> <span class="o">=</span> <span class="n">meshesRadex</span>
            
            <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">checkIntegrityRadex</span><span class="p">()</span>            
        
            <span class="c">#storing the read Db into a dict</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">currentRadexDb</span> <span class="o">=</span> <span class="n">specStr</span>   
            <span class="n">radexDb</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&#39;meshes&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshesRadex</span><span class="p">,</span> <span class="s">&#39;infoAll&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">infoAllRadex</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radexDbs</span><span class="p">[</span><span class="n">specStr</span><span class="p">]</span> <span class="o">=</span> <span class="n">radexDb</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;added </span><span class="si">%s</span><span class="s"> radex database to memory&#39;</span> <span class="o">%</span> <span class="n">specStr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> radex database already read...skipping&#39;</span> <span class="o">%</span> <span class="n">specStr</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="meshArxv.readDbsRadex"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.readDbsRadex">[docs]</a>    <span class="k">def</span> <span class="nf">readDbsRadex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Loads radex database files from disk to a dictionary. The last database loaded is</span>
<span class="sd">        the one being used.</span>
<span class="sd">        </span>
<span class="sd">           :param species: A string or a list of strings holding the names of the species files to be loaded. </span>
<span class="sd">        &quot;&quot;&quot;</span>
  
        <span class="k">if</span> <span class="n">species</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;keyword species is None, must be a list of strings.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="s">&#39;__iter__&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="n">species</span><span class="p">]</span>      
            
        <span class="k">for</span> <span class="n">specStr</span> <span class="ow">in</span> <span class="n">species</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">readDbRadex</span><span class="p">(</span><span class="n">specStr</span><span class="p">,</span> <span class="n">check</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="meshArxv.use_radexDb"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.use_radexDb">[docs]</a>    <span class="k">def</span> <span class="nf">use_radexDb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">specStr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A method which sets a radex database from the databases available in self.radexDbs.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meshesRadex</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radexDbs</span><span class="p">[</span><span class="n">specStr</span><span class="p">][</span><span class="s">&#39;meshes&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infoAllRadex</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radexDbs</span><span class="p">[</span><span class="n">specStr</span><span class="p">][</span><span class="s">&#39;infoAll&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currentRadexDb</span> <span class="o">=</span> <span class="n">specStr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;swithced to </span><span class="si">%s</span><span class="s"> radex database&#39;</span> <span class="o">%</span> <span class="n">specStr</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="meshArxv.mergeDbs"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.mergeDbs">[docs]</a>    <span class="k">def</span> <span class="nf">mergeDbs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newDbRunDirPath</span><span class="p">,</span> <span class="n">outDirPath</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; merges two databases into one and write the resulting db and its info file</span>
<span class="sd">            :param string newDbRunDirPath: the dir in which the new db to be added to the current db is located.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">arxv2</span> <span class="o">=</span> <span class="n">meshArxv</span><span class="p">()</span>
        <span class="n">arxv2</span><span class="o">.</span><span class="n">readDb</span><span class="p">(</span> <span class="n">newDbRunDirPath</span> <span class="p">)</span>
        <span class="n">arxv2</span><span class="o">.</span><span class="n">checkIntegrity</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">arxv2</span><span class="o">.</span><span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ver</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">arxv2</span><span class="o">.</span><span class="n">ver</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ver</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="n">arxv2</span><span class="o">.</span><span class="n">ver</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;can not merge databases with different versions.&#39;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span> <span class="o">+</span> <span class="n">arxv2</span><span class="o">.</span><span class="n">nMeshes</span>
        
        <span class="c"># appending the meshes from the new arxv to the existing one</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="n">arxv2</span><span class="o">.</span><span class="n">nMeshes</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">arxv2</span><span class="o">.</span><span class="n">meshes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
        
        <span class="c"># merging the info arrays (need to update the numbers though</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span><span class="p">,</span> <span class="n">arxv2</span><span class="o">.</span><span class="n">infoAll</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
 
        <span class="c"># merging the info arrays</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="c"># mesh number             </span>
        
        <span class="k">if</span> <span class="n">outDirPath</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writeDb</span><span class="p">(</span><span class="n">outDirPath</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="meshArxv.arxvHdrFormat"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.arxvHdrFormat">[docs]</a>    <span class="k">def</span> <span class="nf">arxvHdrFormat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; the format for the archive header from which the dtype will be constructed</span>
<span class="sd">         specifying the info and paramters for each line in the header</span>
<span class="sd">         in version 1 : the &#39;info&#39; is defined as : (&#39;info&#39; , np.int64  , 5)</span>
<span class="sd">         in version 2 : the &#39;info&#39; is defined as : (&#39;info&#39; , np.int64  , 6)</span>
<span class="sd">         &quot;&quot;&quot;</span>        
        
        <span class="c"># defining the version of the database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ver</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ver</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ver</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ver</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="k">return</span> <span class="p">[</span> 
                  <span class="p">(</span><span class="s">&#39;info&#39;</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span>  <span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;parms&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
               <span class="p">]</span>
</div>
<div class="viewcode-block" id="meshArxv.arxvRadexHdrFormat"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.arxvRadexHdrFormat">[docs]</a>    <span class="k">def</span> <span class="nf">arxvRadexHdrFormat</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; the format for the radex archive header from which the dtype will be constructed</span>
<span class="sd">         specifying the info and paramters for each line in the header</span>
<span class="sd">         in version 1 : the &#39;info&#39; is defined as : (&#39;info&#39; , np.int64  , 5)</span>
<span class="sd">         &quot;&quot;&quot;</span>        
        
        <span class="c"># defining the version of the database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verRadex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verRadex</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verRadex</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verRadex</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="p">[</span> 
                  <span class="p">(</span><span class="s">&#39;info&#39;</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span>  <span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                  <span class="p">(</span><span class="s">&#39;parms&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
               <span class="p">]</span>
        </div>
<div class="viewcode-block" id="meshArxv.checkIntegrity"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.checkIntegrity">[docs]</a>    <span class="k">def</span> <span class="nf">checkIntegrity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;check archive integrity, this is a basic check where the information about the</span>
<span class="sd">             meshes in self.infoAll[&#39;info] is compared to those in self.data for each mesh.</span>
<span class="sd">             </span>
<span class="sd">             :NOTE: that this is a basic check.</span>
<span class="sd">             </span>
<span class="sd">             :TODO: see how to implement a checksum to check for the integrity of the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">diff</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">):</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">])])</span>

            <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;G0&#39;</span><span class="p">]),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;nGas&#39;</span><span class="p">]),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;gammaMech&#39;</span><span class="p">])])</span>

            <span class="n">xdv</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
            <span class="n">diff</span> <span class="o">+=</span>  <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xdv</span><span class="p">,</span><span class="n">xdv</span><span class="p">)</span> <span class="p">)</span>
            
        <span class="k">if</span> <span class="n">diff</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;archive integrity test passed&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">strng</span> <span class="o">=</span> <span class="s">&#39;archive integrity test failed. database file may be corrupt&#39;</span> 
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="n">strng</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="meshArxv.checkIntegrityRadex"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.checkIntegrityRadex">[docs]</a>    <span class="k">def</span> <span class="nf">checkIntegrityRadex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;checks the radex db archive integrity by comparing the read parameters for each mesh</span>
<span class="sd">        (3 float 64&#39;s before the transiotion data) which are stored into self.infoAllRadex[&#39;parms&#39;]</span>
<span class="sd">        once they are read from the meshesRadex.db.specStr and compares them to the mesh </span>
<span class="sd">        parameters in self.infoAll[&#39;parms&#39;].</span>
<span class="sd">             </span>
<span class="sd">        :TODO: see how to implement a checksum to check for the integrity of the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">diff</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">):</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">])])</span>
            
            <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span>
                           <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">])])</span>
            <span class="n">xdv</span> <span class="o">=</span> <span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span>
            <span class="n">diff</span> <span class="o">+=</span>  <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xdv</span><span class="p">,</span><span class="n">xdv</span><span class="p">)</span> <span class="p">)</span>
            
        <span class="k">if</span> <span class="n">diff</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;archive integrity test passed&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">strng</span> <span class="o">=</span> <span class="s">&#39;archive integrity test failed. database file may be corrupt&#39;</span> 
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="n">strng</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="meshArxv.setupChemistry"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.setupChemistry">[docs]</a>    <span class="k">def</span> <span class="nf">setupChemistry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parms</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;sets up the attributes related to the chemistry assuming self.parms[&#39;chemistry&#39;] is set.</span>
<span class="sd">           sets the attribute self.chemNet.</span>
<span class="sd">           </span>
<span class="sd">           :param parms: a dict holding the paths and definitions needed to setup the </span>
<span class="sd">            chemical network.  An example of this dict :</span>
<span class="sd">            </span>
<span class="sd">            .. code-block:: python</span>
<span class="sd">            </span>
<span class="sd">                parms = {</span>
<span class="sd">                        &#39;rxnFile&#39;       : &#39;/home/mher/rate99Fixed.inp&#39;,   # path of the reaction file</span>
<span class="sd">                        &#39;specNumFile&#39;   : &#39;/home/mher/species.inp&#39;,       # the species in the rxnFile</span>
<span class="sd">                        &#39;underAbunFile&#39; : &#39;/home/mher/underabundant.inp&#39;, # species to be excluded from the rxn file</span>
<span class="sd">                        &#39;removeManual&#39;  : [&#39;13CH3&#39;],                      # species to be removed explicitly not in the underabundant file</span>
<span class="sd">                        &#39;baseSpecies&#39;   : &#39;baseSpeciesDefault&#39;,           # name of the module holding the base species</span>
<span class="sd">                        &#39;umistVer&#39;      : &#39;umist99&#39;,                      # version of the umist database</span>
<span class="sd">                         }</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">parms</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">parms</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;chemistry&#39;</span><span class="p">]</span>
            
        <span class="c">#importing the module which holds the definitions of the base species</span>
        <span class="n">baseSpecies</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;baseSpecies&#39;</span><span class="p">])</span>
        <span class="n">baseSpecs</span> <span class="o">=</span> <span class="n">baseSpecies</span><span class="o">.</span><span class="n">baseSpecies</span><span class="p">()</span>
        
        <span class="c"># settin up the orignial netowrk</span>
        <span class="n">net</span> <span class="o">=</span> <span class="n">chemicalNetwork</span><span class="o">.</span><span class="n">chemicalNetwork</span><span class="p">(</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;rxnFile&#39;</span><span class="p">],</span> 
                                              <span class="n">baseSpecs</span><span class="p">,</span>
                                              <span class="n">UMISTVER</span> <span class="o">=</span> <span class="n">parms</span><span class="p">[</span><span class="s">&#39;umistVer&#39;</span><span class="p">])</span>
        
        <span class="c"># reading the species to be removed from a file</span>
        <span class="n">net</span><span class="o">.</span><span class="n">remove_species</span><span class="p">(</span> <span class="n">underAbunFile</span> <span class="o">=</span> <span class="n">parms</span><span class="p">[</span><span class="s">&#39;underAbunFile&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">net</span><span class="o">.</span><span class="n">remove_species</span><span class="p">(</span> <span class="n">species</span> <span class="o">=</span> <span class="n">parms</span><span class="p">[</span><span class="s">&#39;removeManual&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="c"># reading the species number and their corresponding indies and abundances from ascii files</span>
        <span class="n">net</span><span class="o">.</span><span class="n">assign_numbers_to_species</span><span class="p">(</span><span class="n">fileName</span> <span class="o">=</span> <span class="n">parms</span><span class="p">[</span><span class="s">&#39;specNumFile&#39;</span><span class="p">])</span>

        <span class="k">print</span> <span class="s">&#39;------------------------------------------------------------------------------&#39;</span>
        <span class="c">###----------------------------setup the network as in the pdr code---------------</span>
        
        <span class="c">#scratching out reactions  (check if 3707 is removed in the original PDR code)</span>
        <span class="n">net</span><span class="o">.</span><span class="n">pop_reactions</span><span class="p">(</span> <span class="p">[</span><span class="mi">799</span><span class="p">,</span> <span class="mi">3706</span><span class="p">,</span> <span class="mi">3707</span><span class="p">,</span> <span class="mi">4076</span><span class="p">,</span> <span class="mi">4412</span><span class="p">,</span> <span class="mi">4413</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">net</span><span class="o">.</span><span class="n">pop_reactions</span><span class="p">(</span> <span class="n">net</span><span class="o">.</span><span class="n">filter_reactions</span><span class="p">(</span><span class="n">withType</span><span class="o">=</span><span class="s">&#39;TR&#39;</span><span class="p">)</span> <span class="p">)</span>
        
        <span class="c">#changing temperature ranges of some of the reactions</span>
        <span class="n">net</span><span class="o">.</span><span class="n">setattr_rxn</span><span class="p">(</span><span class="mi">5</span>   <span class="p">,</span> <span class="s">&#39;Tu&#39;</span><span class="p">,</span> <span class="mf">700.0</span> <span class="p">);</span> <span class="n">net</span><span class="o">.</span><span class="n">setattr_rxn</span><span class="p">(</span><span class="mi">6</span>   <span class="p">,</span> <span class="s">&#39;Tl&#39;</span><span class="p">,</span> <span class="mf">700.0</span><span class="p">);</span>
        <span class="n">net</span><span class="o">.</span><span class="n">setattr_rxn</span><span class="p">(</span><span class="mi">240</span> <span class="p">,</span> <span class="s">&#39;Tu&#39;</span><span class="p">,</span> <span class="mf">4150.0</span><span class="p">);</span> <span class="n">net</span><span class="o">.</span><span class="n">setattr_rxn</span><span class="p">(</span><span class="mi">241</span> <span class="p">,</span> <span class="s">&#39;Tl&#39;</span><span class="p">,</span> <span class="mf">4150.0</span><span class="p">);</span>
        <span class="n">net</span><span class="o">.</span><span class="n">setattr_rxn</span><span class="p">(</span><span class="mi">240</span> <span class="p">,</span> <span class="s">&#39;Tu&#39;</span><span class="p">,</span> <span class="mf">4150.0</span><span class="p">);</span> <span class="n">net</span><span class="o">.</span><span class="n">setattr_rxn</span><span class="p">(</span><span class="mi">241</span> <span class="p">,</span> <span class="s">&#39;Tl&#39;</span><span class="p">,</span> <span class="mf">4150.0</span><span class="p">);</span>
        
        <span class="c">#setting the lower bounds of the temperature of some reactions</span>
        <span class="c"># [[ID1, Tlb1], [ID2, Tlb2]...[]]</span>
        <span class="n">ID_Tlb</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="mi">63</span> <span class="p">,</span> <span class="mf">10.0</span> <span class="p">],</span> <span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mf">10.0</span>  <span class="p">],</span> <span class="p">[</span><span class="mi">80</span><span class="p">,</span> <span class="mf">300.0</span> <span class="p">],</span>  <span class="p">[</span><span class="mi">131</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">],</span> 
                   <span class="p">[</span><span class="mi">196</span><span class="p">,</span> <span class="mf">300.0</span><span class="p">],</span> <span class="p">[</span><span class="mi">210</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">],</span> <span class="p">[</span><span class="mi">234</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">],</span>  <span class="p">[</span><span class="mi">236</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">273</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">],</span> <span class="p">[</span><span class="mi">275</span><span class="p">,</span> <span class="mf">300.0</span><span class="p">],</span> <span class="p">[</span><span class="mi">298</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">],</span>  <span class="p">[</span><span class="mi">337</span><span class="p">,</span> <span class="mf">250.0</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">343</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">],</span> <span class="p">[</span><span class="mi">348</span><span class="p">,</span> <span class="mf">500.0</span><span class="p">],</span> <span class="p">[</span><span class="mi">354</span><span class="p">,</span> <span class="mf">80.0</span> <span class="p">],</span>  <span class="p">[</span><span class="mi">360</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">363</span><span class="p">,</span> <span class="mf">300.0</span><span class="p">],</span> <span class="p">[</span><span class="mi">366</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">],</span> <span class="p">[</span><span class="mi">374</span><span class="p">,</span> <span class="mf">25.0</span> <span class="p">],</span>  <span class="p">[</span><span class="mi">379</span><span class="p">,</span> <span class="mf">150.0</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">387</span><span class="p">,</span> <span class="mf">300.0</span><span class="p">],</span> <span class="p">[</span><span class="mi">393</span><span class="p">,</span> <span class="mf">13.0</span> <span class="p">],</span> <span class="p">[</span><span class="mi">400</span><span class="p">,</span> <span class="mf">300.0</span><span class="p">],</span>  <span class="p">[</span><span class="mi">414</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">],</span>
                   <span class="p">[</span><span class="mi">425</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">],</span> <span class="p">[</span><span class="mi">432</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">],</span> <span class="p">[</span><span class="mi">4278</span><span class="p">,</span><span class="mf">300.0</span><span class="p">]</span>
                 <span class="p">]</span>
        
        <span class="k">for</span> <span class="n">ID</span><span class="p">,</span> <span class="n">Tlb</span> <span class="ow">in</span> <span class="n">ID_Tlb</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;setting a lower bound to the T to be used in computing the rxn cst&#39;</span>
            <span class="n">net</span><span class="o">.</span><span class="n">setattr_rxn</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="s">&#39;Tlb&#39;</span><span class="p">,</span> <span class="n">Tlb</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&#39;       &#39;</span><span class="p">,</span>
            <span class="n">net</span><span class="o">.</span><span class="n">print_reactions</span><span class="p">(</span><span class="n">ID</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;type rxn trng Tlb&#39;</span><span class="p">)</span>
        
        <span class="c">#in looking at chemcial_balance.c we see that all the reactions which have no</span>
        <span class="c">#Tl and Tu set, the rates are valid for all temperatures, so we set those to</span>
        <span class="c">#the min and max of UMIST Tl=10 and Tu=41000</span>
        <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rxn</span><span class="o">.</span><span class="n">Tl</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">rxn</span><span class="o">.</span><span class="n">Tu</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">rxn</span><span class="o">.</span><span class="n">Tl</span> <span class="o">=</span> <span class="mf">10.0</span>
                <span class="n">rxn</span><span class="o">.</span><span class="n">Tu</span> <span class="o">=</span> <span class="mf">41000.0</span>
                <span class="k">print</span> <span class="s">&#39;set trange manually &#39;</span><span class="p">,</span> 
                <span class="n">rxn</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;rxn trng&#39;</span><span class="p">)</span>
        
        <span class="c">#setting the functions which compute the reactions constants</span>
        <span class="k">print</span> <span class="s">&#39;setting the functions which will compute the reaction constants&#39;</span>
        <span class="n">net</span><span class="o">.</span><span class="n">set_rxn_cst_functions</span><span class="p">()</span>
        
        <span class="c">#checking if all the reactions have the functions set</span>
        <span class="n">found</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">rxn</span> <span class="ow">in</span> <span class="n">net</span><span class="o">.</span><span class="n">reactions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rxn</span><span class="o">.</span><span class="n">compute_rxn_cst_func</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">found</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">rxn</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">fmt</span><span class="o">=</span><span class="s">&#39;id rxn&#39;</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="n">found</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;one or more reaction does not have a rxn cst function set...see above..&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;reaction constant functions for all the reactions are set&#39;</span>
            
        <span class="c">#now that the ranges of some of the reactions are set/modified, we can merge them</span>
        <span class="c">#and set the functions which compute the constants give a temperature </span>
        <span class="n">net</span><span class="o">.</span><span class="n">merge_identical_reactions</span><span class="p">()</span>
        <span class="n">net</span><span class="o">.</span><span class="n">set_all_rxn_bounds</span><span class="p">()</span>
        <span class="c">###------------------done setting up the network as in the pdr code---------------</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">setChemicalNetwork</span><span class="p">(</span><span class="n">net</span><span class="p">)</span> <span class="c"># assiginig the chemical network to the archive</span>
            </div>
<div class="viewcode-block" id="meshArxv.getQuantityFromAllMeshes"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.getQuantityFromAllMeshes">[docs]</a>    <span class="k">def</span> <span class="nf">getQuantityFromAllMeshes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">slabIdx</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">arrIdx</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; gets the quantity from all the meshes and returns it as a numpy array. </span>
<span class="sd">            the quantity is mandatory, but no the slabIdx.</span>
<span class="sd">            </span>
<span class="sd">            :param int arrIdx: in case the quantity pointed to is an array, arrIdx would be the </span>
<span class="sd">              index in the array we would like to retrieve.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">):</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">fetchNestedDtypeValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">quantity</span> <span class="p">)</span>
        
            <span class="k">if</span> <span class="n">slabIdx</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">arrIdx</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">arrIdx</span><span class="p">][</span><span class="n">slabIdx</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">slabIdx</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">arrIdx</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">slabIdx</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">q</span>

            <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>  
                
        <span class="k">return</span> <span class="n">values</span>
        </div>
<div class="viewcode-block" id="meshArxv.construct3DInterpolationFunction"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.construct3DInterpolationFunction">[docs]</a>    <span class="k">def</span> <span class="nf">construct3DInterpolationFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">slabIdx</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">arrIdx</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">log10</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a 3D interpolation function (interpolate.LinearNDInterpolator) which</span>
<span class="sd">           can be used to compute values determined by quantity give (nGas, G0, Gmech)</span>
<span class="sd">           (in log_10). The value to be interpolated upon is determined by the parameter</span>
<span class="sd">           quantity and the slab index determined by :data:`slabIdx`. For example, to construct an interpolation table for say surface</span>
<span class="sd">           temperature, this method can be invoked as :</span>
<span class="sd">             </span>
<span class="sd">           .. code-block:: python</span>

<span class="sd">                f = arvx.construct3DInterpolationFunction( quantity = [&#39;state&#39;, &#39;gasT&#39;], slabIdx = 0 )</span>
<span class="sd">             </span>
<span class="sd">           See :data:`computeInterpolated2DGrid` for an example on how to use this interpolation </span>
<span class="sd">           function. Upon returning, this method sets the values of the attributes</span>
<span class="sd">           grid_x,y,z.</span>
<span class="sd">                </span>
<span class="sd">           :param list quantity: this is a list of strings which point to the data</span>
<span class="sd">            to be extracted from the dtype :data:`mesh`. (see example above)</span>
<span class="sd">           :param int32 slabIdx: the index of the slab from which the value will be extracted.</span>
<span class="sd">           :param int32 arrIdx: The first index in the 2D array (ONLY necessary if the quantity pointed</span>
<span class="sd">            to is a 2D array, like [&#39;state&#39;, &#39;abun&#39;]). In this case slabIdx is used as the seconds index. </span>
<span class="sd">           :param bool log10: keyword which when passes as True, will generate the log10 of the quantity</span>
<span class="sd">           :param numpy.ndarray values: a numpy 1D array whose size if the same as the number of meshes which</span>
<span class="sd">             when passed as an argument, will be used as the value to be interpolated. In this case,</span>
<span class="sd">             quantity, slabIdx, arrIdx are ignored. </span>
<span class="sd">           :param numpy.ndarray data: </span>
<span class="sd">             </span>
<span class="sd">           .. todo:: modify this to construct the table over a selected range of the 3D </span>
<span class="sd">               parameter space instead of using all the meshes. (optional)</span>
<span class="sd">                </span>
<span class="sd">           .. warning:: this fails if all the entries in one of the dimensions have the exact same value. in that case use :data:`construct2DInterpolationFunction`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># checking if the grid_x,y,z are set, if not, set them        </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_grid_axes_quantity_values</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="n">values</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># the quantitiy we are intiesrested in showing</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getQuantityFromAllMeshes</span><span class="p">(</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">slabIdx</span> <span class="o">=</span> <span class="n">slabIdx</span><span class="p">,</span> <span class="n">arrIdx</span> <span class="o">=</span> <span class="n">arrIdx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span>

        <span class="k">if</span> <span class="n">log10</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">log10</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">values</span><span class="p">[:])</span>

        <span class="k">if</span> <span class="n">data</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>  <span class="c">#3D coordinates</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        
        <span class="n">ti</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">LinearNDInterpolator</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="c"># getting the interpolation function     </span>
        <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;constructed the interpolation function from </span><span class="si">%d</span><span class="s"> points in </span><span class="si">%f</span><span class="s"> seconds&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="n">tf</span><span class="o">-</span><span class="n">ti</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">f</span>
</div>
<div class="viewcode-block" id="meshArxv.construct2DInterpolationFunction"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.construct2DInterpolationFunction">[docs]</a>    <span class="k">def</span> <span class="nf">construct2DInterpolationFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">slabIdx</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; same as :data:`construct3DInterpolationFunction` but does it for n and G0</span>
<span class="sd">        </span>
<span class="sd">            .. warning:: make sure that the G_mech for all the models is the same. Other</span>
<span class="sd">               things will not make sense, bec the models would have diffrent G_mech</span>
<span class="sd">               </span>
<span class="sd">            .. warning:: make sure that the interpolated points are at the centroids of the grid points</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">getQuantityFromAllMeshes</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_qx</span> <span class="p">)</span> <span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">getQuantityFromAllMeshes</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_qy</span> <span class="p">)</span> <span class="p">)</span>
        
        <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getQuantityFromAllMeshes</span><span class="p">(</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">slabIdx</span> <span class="o">=</span> <span class="n">slabIdx</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>  <span class="c">#2D</span>
        
        <span class="n">ti</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">LinearNDInterpolator</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span> <span class="c"># getting the interpolation function     </span>
        <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;constructed the interpolation function from </span><span class="si">%d</span><span class="s"> points in </span><span class="si">%f</span><span class="s"> seconds&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">),</span> <span class="n">tf</span><span class="o">-</span><span class="n">ti</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">f</span> 
</div>
<div class="viewcode-block" id="meshArxv.computeInterpolated2DGrid"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.computeInterpolated2DGrid">[docs]</a>    <span class="k">def</span> <span class="nf">computeInterpolated2DGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ranges</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">zSec</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> 
                                  <span class="n">fInterp</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a 2D array ( a numpy ndarray ) of size res[0] and res[1] (check this if it is not the reverse) which holds</span>
<span class="sd">           the interpolated vlaues of &#39;quantity&#39; over the domain determined by ranges for a slab whose index is slabIdx for</span>
<span class="sd">           a mechanical heating zSec (in log10). ( x is the horizontal direction of the mesh, and y is the vertical).</span>
<span class="sd">             </span>
<span class="sd">           An example would be (assuming the archive is constructed already):</span>
<span class="sd">             </span>
<span class="sd">           .. code-block:: python</span>

<span class="sd">                f   = arxv.construct3DInterpolationFunction(quantity = [&#39;state&#39;, &#39;gasT&#39;], </span>
<span class="sd">                                                            slabIdx  = 0)</span>
<span class="sd">                grd = arxv.computeInterpolated2DGrid(slabIdx  = 0, </span>
<span class="sd">                                                     ranges   = [[0,6],[0,6]],</span>
<span class="sd">                                                     res      = [100,100], </span>
<span class="sd">                                                     zSec     = -30, </span>
<span class="sd">                                                     fInterp  = f)</span>


<span class="sd">                import matplotlib.pyplot as plt</span>
<span class="sd">                plt.imshow(grd, extent=(0,1,0,1), origin=&#39;lower&#39;)</span>
<span class="sd">                plt.show()</span>

<span class="sd">           :param list ranges: a 2d list holding the ranges of the grid [[xmin, xmax],[ymin, ymax]]</span>
<span class="sd">           :param list res: the resolution in each dimension. [xResolution, yResolution]</span>
<span class="sd">           :param float zSec: the section in mechanical heating to be interpolated at.</span>
<span class="sd">           :param scipy.interpolate.LinearNDInterpolator fInterp: the interpolation function returned by</span>
<span class="sd">                   :data:`construct2DInterpolationFunction` or it 3D counterpart.        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># defining the points in the uniform 2D grid                                                                                                                                                                                                 </span>
        <span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span><span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                                  <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span><span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">res</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="n">nPts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">grid_x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">xNew</span> <span class="o">=</span> <span class="n">grid_x</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nPts</span><span class="p">)</span>
        <span class="n">yNew</span> <span class="o">=</span> <span class="n">grid_y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nPts</span><span class="p">)</span>
        <span class="n">zNew</span> <span class="o">=</span> <span class="n">xNew</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        
        <span class="c"># setting the values of mechanical heating to interpolate on</span>
        <span class="n">zNew</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">zSec</span>      <span class="c"># all the grid points have the same mechanical heating</span>
        
        <span class="n">dataNew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span><span class="n">xNew</span><span class="p">,</span> <span class="n">yNew</span><span class="p">,</span> <span class="n">zNew</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">T</span>
        
        <span class="n">ti</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="n">tNew</span> <span class="o">=</span> <span class="n">fInterp</span><span class="p">(</span><span class="n">dataNew</span><span class="p">)</span>
        <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;interpolated </span><span class="si">%d</span><span class="s"> points in </span><span class="si">%f</span><span class="s"> seconds at a rate of </span><span class="si">%e</span><span class="s"> pts/sec&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nPts</span><span class="p">,</span> <span class="n">tf</span><span class="o">-</span><span class="n">ti</span><span class="p">,</span> <span class="n">nPts</span> <span class="o">/</span> <span class="p">(</span><span class="n">tf</span><span class="o">-</span><span class="n">ti</span><span class="p">)))</span>
        <span class="n">tNew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">tNew</span><span class="p">,</span> <span class="n">grid_x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">tNew</span><span class="p">,</span> <span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span>
        </div>
<div class="viewcode-block" id="meshArxv.showGrid"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.showGrid">[docs]</a>    <span class="k">def</span> <span class="nf">showGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">slabIdx</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">ranges</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">zSec</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">fInterp</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This method displays a plot (useful for standalone use) of a grid of the quantity pointed by quantity in a new</span>
<span class="sd">           window. It makes use of :data:`computeInterpolated2DGrid` and :data:`construct3DInterpolationFunction`.</span>
<span class="sd">           For the documentation of the parameters see  :data:`computeInterpolated2DGrid`</span>
<span class="sd">           </span>
<span class="sd">           :param string quantity: (see construct3DInterpolationFunction documentation)</span>
<span class="sd">           :param interpolate.LinearNDInterpolator fInterp: an interpolation function function returned by</span>
<span class="sd">             :data:`construct3DInterpolationFunction` or it 2D analogue. If this is set, the quantity </span>
<span class="sd">             keyword is meaningless.</span>
<span class="sd">           :param list res: (see self.computeInterpolated2DGrid)</span>
<span class="sd">           </span>
<span class="sd">           :return: aaa</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_default_attributes</span><span class="p">()</span>
        
        <span class="c"># getting the grid</span>
        <span class="k">if</span> <span class="n">fInterp</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct3DInterpolationFunction</span><span class="p">(</span><span class="n">quantity</span> <span class="o">=</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">slabIdx</span>  <span class="o">=</span> <span class="n">slabIdx</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">fInterp</span>
        <span class="n">grd</span><span class="p">,</span> <span class="n">grdx</span><span class="p">,</span> <span class="n">grdy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeInterpolated2DGrid</span><span class="p">(</span><span class="n">ranges</span>   <span class="o">=</span> <span class="n">ranges</span><span class="p">,</span>
                                                        <span class="n">res</span>      <span class="o">=</span> <span class="n">res</span><span class="p">,</span> 
                                                        <span class="n">zSec</span>     <span class="o">=</span> <span class="n">zSec</span><span class="p">,</span> 
                                                        <span class="n">fInterp</span>  <span class="o">=</span> <span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
             
        <span class="c"># taking the transpose for plotting purposes</span>
        <span class="n">grd</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">T</span>
        
        <span class="c"># plotting it</span>
        <span class="k">if</span> <span class="s">&#39;figure&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">pyl</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">pyl</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            
        <span class="n">im</span> <span class="o">=</span> <span class="n">pyl</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">grd</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">)</span>
        
        <span class="c"># adding levels and labels</span>
        <span class="n">nlevels</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">dl</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">grd</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">grd</span><span class="p">))</span><span class="o">/</span><span class="n">nlevels</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">grd</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">grd</span><span class="p">),</span> <span class="n">dl</span> <span class="p">)</span>
        <span class="c">#print grd</span>
        <span class="n">CS</span> <span class="o">=</span> <span class="n">pyl</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">grd</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">pyl</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">CS</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%.1f</span><span class="s">&#39;</span> <span class="p">)</span>
        
        <span class="n">pyl</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">shrink</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span> <span class="n">extend</span> <span class="o">=</span> <span class="s">&#39;both&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">()</span>
</div>
<div class="viewcode-block" id="meshArxv.computeAndSetInterpolationFunctions"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.computeAndSetInterpolationFunctions">[docs]</a>    <span class="k">def</span> <span class="nf">computeAndSetInterpolationFunctions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;compute the 3D interpolation functions which will be used to compute the 2D grids.</span>
<span class="sd">            sets the attributes : self.grdInterp_f, self.abunGridInterp_f, self.colDensGridInterp_f</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c"># computing the surface temperature interpolation function which will be used to make the high res maps</span>
        <span class="c">#######################################################################################################</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;00&#39;</span><span class="p">][</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grdInterp_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct3DInterpolationFunction</span><span class="p">(</span><span class="n">quantity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;00&#39;</span><span class="p">][</span><span class="s">&#39;quantity&#39;</span><span class="p">],</span> 
                                                                     <span class="n">slabIdx</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;00&#39;</span><span class="p">][</span><span class="s">&#39;slabIdx&#39;</span><span class="p">],</span>
                                                                     <span class="n">log10</span>    <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                                                                     <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c"># computing the abundance interpolation function which will be used to make the high res maps</span>
        <span class="c">#############################################################################################</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;01&#39;</span><span class="p">][</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">abunGridInterp_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct3DInterpolationFunction</span><span class="p">(</span><span class="n">quantity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;01&#39;</span><span class="p">][</span><span class="s">&#39;quantity&#39;</span><span class="p">],</span> 
                                                                          <span class="n">slabIdx</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;01&#39;</span><span class="p">][</span><span class="s">&#39;slabIdx&#39;</span><span class="p">],</span>
                                                                          <span class="n">arrIdx</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemNet</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;01&#39;</span><span class="p">][</span><span class="s">&#39;specStr&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">num</span><span class="p">,</span>
                                                                          <span class="n">log10</span>    <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                                                                          <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c"># computing the column density interpolation function which will be used to make the high res maps</span>
        <span class="c">##################################################################################################</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;10&#39;</span><span class="p">][</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
            <span class="c">#getting the column densities for all the models</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">mesh</span><span class="p">(</span><span class="n">chemNet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemNet</span><span class="p">,</span> <span class="n">metallicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metallicity</span><span class="p">)</span>
            <span class="n">values</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
             
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">):</span>
                <span class="n">m</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">specStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;10&#39;</span><span class="p">][</span><span class="s">&#39;specStr&#39;</span><span class="p">]</span>
                <span class="n">colDens</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">getColumnDensity</span><span class="p">(</span><span class="n">specsStrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">specStr</span><span class="p">],</span> <span class="n">maxAv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;10&#39;</span><span class="p">][</span><span class="s">&#39;maxAv&#39;</span><span class="p">]</span> <span class="p">)</span>
                <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">colDens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
         
            <span class="bp">self</span><span class="o">.</span><span class="n">colDensGridInterp_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct3DInterpolationFunction</span><span class="p">(</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">,</span>
                                                                             <span class="n">log10</span>  <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                                                                             <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c"># computing the line intensity interpolation function which will be used to make the high res maps</span>
        <span class="c">##################################################################################################</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
             
            <span class="n">radiativeCodeType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;type&#39;</span><span class="p">]</span>
            
            <span class="c">#----------------------------emissions using radex---------------------------------------</span>
            <span class="k">if</span> <span class="n">radiativeCodeType</span> <span class="o">==</span> <span class="s">&#39;radex&#39;</span><span class="p">:</span>

                <span class="n">values</span><span class="p">,</span> <span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span><span class="p">,</span> <span class="n">grid_z</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>

                <span class="n">transitionIdx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;transitionIndx&#39;</span><span class="p">]</span>
                <span class="n">quantity</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span>
            
                <span class="c">#looping over all the radex info of all the mesehes and getting the</span>
                <span class="c">#transition data to be displayed</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">):</span>
                    
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshesRadex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                            
                            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshesRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">transitionIdx</span><span class="p">][</span><span class="n">quantity</span><span class="p">]</span>
                            
                            <span class="c"># appending the data and the value to a list to be used</span>
                            <span class="c"># in making the interpolation function</span>
                            
                            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">v</span> <span class="p">)</span>
                            <span class="n">grid_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span>
                            <span class="n">grid_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">y</span> <span class="p">)</span>
                            <span class="n">grid_z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">z</span> <span class="p">)</span>
                            
                <span class="c"># getting the data in the shape that is accepted by the interpolation construction        </span>
                <span class="n">data</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span><span class="p">,</span> <span class="n">grid_z</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> 
                <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">values</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">intensityGridInterp_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct3DInterpolationFunction</span><span class="p">(</span><span class="n">data</span>   <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
                                                                                   <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">,</span>
                                                                                   <span class="n">log10</span>  <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                                                                                   <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="c">#----------------------------emissions from the PDR slabs---------------------------------------</span>
            <span class="k">if</span> <span class="n">radiativeCodeType</span> <span class="o">==</span> <span class="s">&#39;pdr&#39;</span><span class="p">:</span>

                <span class="c">#getting the column densities for all the models</span>
                <span class="n">values</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="c">#a temporary object used to calculate stuff from a pdr mesh object</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">mesh</span><span class="p">(</span><span class="n">chemNet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemNet</span><span class="p">,</span> <span class="n">metallicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metallicity</span><span class="p">)</span>
                
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="p">):</span>
                    
                    <span class="n">m</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span> <span class="n">data</span> <span class="p">)</span>
                    
                    <span class="n">quantity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span><span class="o">*</span><span class="n">m</span><span class="o">.</span><span class="n">compute_integrated_quantity</span><span class="p">(</span><span class="n">quantity</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;negative intensitiy detected - setting it to 0&#39;</span><span class="p">)</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="c">#print self.grid_x[i], self.grid_y[i], self.grid_z[i], v </span>

                    <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span> 
        
                <span class="bp">self</span><span class="o">.</span><span class="n">intensityGridInterp_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct3DInterpolationFunction</span><span class="p">(</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">,</span>
                                                                                 <span class="n">log10</span>  <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                                                                                 <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                    </div>
<div class="viewcode-block" id="meshArxv.show_pdr_mesh_quantity_grid"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.show_pdr_mesh_quantity_grid">[docs]</a>    <span class="k">def</span> <span class="nf">show_pdr_mesh_quantity_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ranges</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;shows the surface temperature grid</span>
<span class="sd">            </span>
<span class="sd">           .. todo:: plot every other labeled contour as a tick in the colorbar</span>
<span class="sd">           </span>
<span class="sd">           .. warning:: there would be a memeory leak if things are plotted over and over</span>
<span class="sd">               the images, labels..etc..must be replaced and not new instance created</span>
<span class="sd">               and overplotted...take care of that later... </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;maps2d&#39;</span><span class="p">][</span><span class="s">&#39;00&#39;</span><span class="p">]</span>
        
        <span class="n">grd</span><span class="p">,</span> <span class="n">grdx</span><span class="p">,</span> <span class="n">grdy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeInterpolated2DGrid</span><span class="p">(</span><span class="n">ranges</span>   <span class="o">=</span> <span class="n">ranges</span><span class="p">,</span>
                                                        <span class="n">res</span>      <span class="o">=</span> <span class="n">res</span><span class="p">,</span>  
                                                        <span class="n">zSec</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltGmSec</span><span class="p">,</span> 
                                                        <span class="n">fInterp</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grdInterp_f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">grd</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">T</span>
        <span class="n">im00</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">grd</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">)</span>
        <span class="n">nlevels</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">dl</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">grd</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">grd</span><span class="p">))</span><span class="o">/</span><span class="n">nlevels</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">grd</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">grd</span><span class="p">),</span> <span class="n">dl</span> <span class="p">)</span>

        <span class="n">panel</span><span class="p">[</span><span class="s">&#39;contour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">grd</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">panel</span><span class="p">[</span><span class="s">&#39;contour&#39;</span><span class="p">],</span> <span class="n">levels</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%.1f</span><span class="s">&#39;</span> <span class="p">)</span>
        
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">pyl</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im00</span><span class="p">,</span> <span class="n">cax</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axesCbar&#39;</span><span class="p">],</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">],</span> 
                            <span class="n">orientation</span> <span class="o">=</span> <span class="s">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">ticks</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%.1f</span><span class="s">&#39;</span><span class="p">)</span>
        
        </div>
<div class="viewcode-block" id="meshArxv.showAbundancesGrid"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.showAbundancesGrid">[docs]</a>    <span class="k">def</span> <span class="nf">showAbundancesGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ranges</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;shows the abundances grid&quot;&quot;&quot;</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;maps2d&#39;</span><span class="p">][</span><span class="s">&#39;01&#39;</span><span class="p">]</span>
            

        <span class="n">grd</span><span class="p">,</span> <span class="n">grdx</span><span class="p">,</span> <span class="n">grdy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeInterpolated2DGrid</span><span class="p">(</span><span class="n">ranges</span>   <span class="o">=</span> <span class="n">ranges</span><span class="p">,</span>
                                                         <span class="n">res</span>      <span class="o">=</span> <span class="n">res</span><span class="p">,</span>  
                                                         <span class="n">zSec</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltGmSec</span><span class="p">,</span> 
                                                         <span class="n">fInterp</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">abunGridInterp_f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="n">grd</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">T</span>
        <span class="n">im01</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">grd</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">)</span>
        <span class="n">nlevels</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">dl</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">grd</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">grd</span><span class="p">))</span><span class="o">/</span><span class="n">nlevels</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">grd</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">grd</span><span class="p">),</span> <span class="n">dl</span> <span class="p">)</span>

        <span class="n">panel</span><span class="p">[</span><span class="s">&#39;contour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">grd</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">panel</span><span class="p">[</span><span class="s">&#39;contour&#39;</span><span class="p">],</span><span class="n">levels</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%.1f</span><span class="s">&#39;</span> <span class="p">)</span>
        
        <span class="n">pyl</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im01</span><span class="p">,</span> <span class="n">cax</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axesCbar&#39;</span><span class="p">],</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">],</span>
                     <span class="n">orientation</span> <span class="o">=</span> <span class="s">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">ticks</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%.1f</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="meshArxv.showColumnDensityGrid"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.showColumnDensityGrid">[docs]</a>    <span class="k">def</span> <span class="nf">showColumnDensityGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ranges</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;shows the abundances grid&quot;&quot;&quot;</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;maps2d&#39;</span><span class="p">][</span><span class="s">&#39;10&#39;</span><span class="p">]</span>

        <span class="n">grd</span><span class="p">,</span> <span class="n">grdx</span><span class="p">,</span> <span class="n">grdy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeInterpolated2DGrid</span><span class="p">(</span><span class="n">ranges</span>   <span class="o">=</span> <span class="n">ranges</span><span class="p">,</span>
                                                         <span class="n">res</span>      <span class="o">=</span> <span class="n">res</span><span class="p">,</span>  
                                                         <span class="n">zSec</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltGmSec</span><span class="p">,</span> 
                                                         <span class="n">fInterp</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">colDensGridInterp_f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="n">grd</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">T</span>
        <span class="n">im10</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">grd</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">)</span>
        <span class="n">nlevels</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">dl</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">grd</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">grd</span><span class="p">))</span><span class="o">/</span><span class="n">nlevels</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">grd</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">grd</span><span class="p">),</span> <span class="n">dl</span> <span class="p">)</span>
        
        <span class="n">panel</span><span class="p">[</span><span class="s">&#39;contour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">grd</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">panel</span><span class="p">[</span><span class="s">&#39;contour&#39;</span><span class="p">],</span><span class="n">levels</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%.1f</span><span class="s">&#39;</span> <span class="p">)</span>
        
        <span class="n">pyl</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im10</span><span class="p">,</span> <span class="n">cax</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axesCbar&#39;</span><span class="p">],</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">],</span>
                     <span class="n">orientation</span> <span class="o">=</span> <span class="s">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">ticks</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%.1f</span><span class="s">&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="meshArxv.showLineIntensityGrid"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.showLineIntensityGrid">[docs]</a>    <span class="k">def</span> <span class="nf">showLineIntensityGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ranges</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;shows the line intensity grid&quot;&quot;&quot;</span>            
        <span class="n">panel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;maps2d&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">]</span>

        <span class="n">grd</span><span class="p">,</span> <span class="n">grdx</span><span class="p">,</span> <span class="n">grdy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeInterpolated2DGrid</span><span class="p">(</span><span class="n">ranges</span>   <span class="o">=</span> <span class="n">ranges</span><span class="p">,</span>
                                                         <span class="n">res</span>      <span class="o">=</span> <span class="n">res</span><span class="p">,</span>  
                                                         <span class="n">zSec</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltGmSec</span><span class="p">,</span> 
                                                         <span class="n">fInterp</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensityGridInterp_f</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                                                        
        <span class="n">grd</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">T</span>
        <span class="n">im11</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">grd</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">)</span>

        <span class="n">mn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span> <span class="n">grd</span><span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">grd</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="p">)</span> <span class="p">]</span> <span class="p">)</span>
        <span class="n">mx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span> <span class="n">grd</span><span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">grd</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span> <span class="p">)</span> <span class="p">]</span> <span class="p">)</span>
        <span class="n">nlevels</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">dl</span> <span class="o">=</span> <span class="p">(</span><span class="n">mx</span> <span class="o">-</span> <span class="n">mn</span><span class="p">)</span><span class="o">/</span><span class="n">nlevels</span>            
        <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="n">mn</span><span class="p">,</span> <span class="n">mx</span><span class="p">,</span> <span class="n">dl</span> <span class="p">)</span>
        
        <span class="c"># computing and displaying the contour levels to be plotted</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;showContours&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">panel</span><span class="p">[</span><span class="s">&#39;contour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">grd</span><span class="p">,</span> <span class="n">levels</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">(</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="n">origin</span><span class="o">=</span><span class="s">&#39;lower&#39;</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="s">&#39;black&#39;</span><span class="p">)</span>
            <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">panel</span><span class="p">[</span><span class="s">&#39;contour&#39;</span><span class="p">],</span><span class="n">levels</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%.1f</span><span class="s">&#39;</span> <span class="p">)</span>
        
        <span class="n">pyl</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im11</span><span class="p">,</span> <span class="n">cax</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axesCbar&#39;</span><span class="p">],</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">],</span> <span class="n">orientation</span> <span class="o">=</span> <span class="s">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">ticks</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[::</span><span class="mi">2</span><span class="p">],</span> <span class="n">format</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%.1f</span><span class="s">&#39;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;radex&#39;</span><span class="p">:</span>
            <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axesCbar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Intensity </span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;specStr&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;transitionIndx&#39;</span><span class="p">])</span>  <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;pdr&#39;</span><span class="p">:</span>
            <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axesCbar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Intensity </span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;quantity&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;quantity&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="p">)</span>
        </div>
<div class="viewcode-block" id="meshArxv.constructRadexDatabase"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.constructRadexDatabase">[docs]</a>    <span class="k">def</span> <span class="nf">constructRadexDatabase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">writeDb</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;runs radex on all the models in self.meshes, and computes the line info </span>
<span class="sd">           according to the parameters in self.parms[&#39;radex&#39;]. Once done computing,</span>
<span class="sd">           it stores all the generated info into self.infoAllRadex and :data:`meshesRadex`.</span>
<span class="sd">        </span>
<span class="sd">           :param bool writeDb: if this is set to true, self.infoAllRadex is writtent to a </span>
<span class="sd">            file self.dirPath/infoAllRadex.db.info.&#39;specStr&#39; and self.meshesRadex is written</span>
<span class="sd">            to self.dirPath/meshesRadex.db.&#39;specStr&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># defining the array holding the info about all the computed radex transitions</span>
        <span class="c"># for each model in self.meshes and their location in the radex database ..etc..</span>
        <span class="n">arxvRadexHdrDtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">arxvRadexHdrFormat</span><span class="p">()</span> <span class="p">)</span>
        <span class="n">infoAllRadex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">arxvRadexHdrDtype</span> <span class="p">)</span>
        <span class="c">#initiliizing to zero</span>
        <span class="n">infoAllRadex</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">meshesRadex</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">radexObj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span>
        <span class="c"># mesh object which will be used as a utility to compute the stuff needed </span>
        <span class="c"># by radex to run, as in m.getRadexParameters() to get tKin, nDensCollisionPartners, molnDens</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">mesh</span><span class="p">(</span><span class="n">chemNet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemNet</span><span class="p">,</span> <span class="n">metallicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metallicity</span><span class="p">)</span>
        
        <span class="n">specStr</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;specStr&#39;</span><span class="p">]</span>
        <span class="n">xH2_Min</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;xH2_Min&#39;</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">):</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;pdr mesh index =  </span><span class="si">%d</span><span class="s"> : &#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
            
            <span class="n">m</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
            <span class="p">(</span><span class="n">gasTRadex</span><span class="p">,</span> <span class="n">nColls</span><span class="p">,</span> <span class="n">colDensThisSpec</span><span class="p">,)</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">getRadexParameters</span><span class="p">(</span><span class="n">speciesStr</span> <span class="o">=</span> <span class="n">specStr</span><span class="p">,</span>
                                                                         <span class="n">threshold</span>  <span class="o">=</span> <span class="n">xH2_Min</span><span class="p">)</span>
            <span class="c"># getting the collider densities in the same order of the supplied input spcie string list </span>
            <span class="n">nDensColls</span> <span class="o">=</span> <span class="p">[</span> <span class="n">nColls</span><span class="p">[</span><span class="n">collSpecStr</span><span class="p">]</span> <span class="k">for</span> <span class="n">collSpecStr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;collisionPartners&#39;</span><span class="p">]</span> <span class="p">]</span>
            <span class="n">collsStr</span>   <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;collisionPartners&#39;</span><span class="p">])</span>

            <span class="n">radexObj</span><span class="o">.</span><span class="n">setInFileParm</span><span class="p">(</span><span class="s">&#39;tKin&#39;</span><span class="p">,</span> <span class="n">gasTRadex</span><span class="p">)</span>
            <span class="n">radexObj</span><span class="o">.</span><span class="n">setInFileParm</span><span class="p">(</span><span class="s">&#39;collisionPartners&#39;</span><span class="p">,</span> <span class="n">collsStr</span> <span class="p">)</span>
            <span class="n">radexObj</span><span class="o">.</span><span class="n">setInFileParm</span><span class="p">(</span><span class="s">&#39;nDensCollisionPartners&#39;</span><span class="p">,</span> <span class="n">nDensColls</span> <span class="p">)</span>
            <span class="n">radexObj</span><span class="o">.</span><span class="n">setInFileParm</span><span class="p">(</span><span class="s">&#39;molnDens&#39;</span><span class="p">,</span> <span class="n">colDensThisSpec</span><span class="p">)</span>

            <span class="c">#remove colliders which are underabundant (below radex limits)</span>
            <span class="n">radexObj</span><span class="o">.</span><span class="n">filterColliders</span><span class="p">()</span>

            <span class="c">#all colliders have densities outsie the range accepted by radex</span>
            <span class="c">#filling the data as empty and skipping this radex computation</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">radexObj</span><span class="o">.</span><span class="n">inFile</span><span class="p">[</span><span class="s">&#39;collisionPartners&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">#no trainsitions</span>
                <span class="n">meshesRadex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
                <span class="n">radexObj</span><span class="o">.</span><span class="n">printSetFlags</span><span class="p">()</span>
                <span class="k">continue</span>
            
            <span class="c">#----------------------------------running radex---------------------------------</span>
            <span class="n">radexOutputMakesSense</span> <span class="o">=</span> <span class="bp">False</span>
            
            <span class="c">#parameters used for attempting to get radex to converge and vlaues make sense</span>
            <span class="n">inFileOrig</span> <span class="o">=</span> <span class="n">radexObj</span><span class="o">.</span><span class="n">inFile</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c"># original parameters</span>
            <span class="n">popDensTol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;popDensSumTol&#39;</span><span class="p">]</span>  <span class="c"># ideally sum pop dens lower should be 1, for values less than tol</span>
                                                              <span class="c"># the parameters are changed by &#39;changeFac&#39; and another attempt is done</span>
                                                              <span class="c"># until the sum of pop dens is close to 1 up to tol. </span>
            <span class="n">changeFac</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;changeFracTrial&#39;</span><span class="p">]</span>  <span class="c"># the relative amount by which the input parameters to radex are changed</span>
            <span class="n">nMaxTrial</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;nMaxTrial&#39;</span><span class="p">]</span>     <span class="c"># number of time random changes are done before giving up</span>
            
            <span class="n">nTried</span>     <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="ow">not</span> <span class="n">radexOutputMakesSense</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;radex trial </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">nTried</span><span class="p">)</span>
                <span class="n">radexObj</span><span class="o">.</span><span class="n">setDefaultStatus</span><span class="p">()</span>
                <span class="n">status</span> <span class="o">=</span> <span class="n">radexObj</span><span class="o">.</span><span class="n">run</span><span class="p">(</span> <span class="n">checkInput</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;checkOutputIntegrity&#39;</span><span class="p">]:</span>
                    <span class="c"># checking the integrity of the solution in case it converged</span>
                    <span class="k">if</span> <span class="n">radexObj</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">radexObj</span><span class="o">.</span><span class="n">FLAGS</span><span class="p">[</span><span class="s">&#39;SUCCESS&#39;</span><span class="p">]:</span>
                        
                        <span class="n">totalPopDensLower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">radexObj</span><span class="o">.</span><span class="n">transitions</span><span class="p">[:][</span><span class="s">&#39;pop_down&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;popDensSumExpected&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">totalPopDensLower</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">popDensTol</span><span class="p">:</span>
                            
                            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;====&gt; pop dens does NOT make sense, trial </span><span class="si">%d</span><span class="se">\n</span><span class="s">====&gt; total pop dense lower = </span><span class="si">%20.10f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">nTried</span><span class="p">,</span> <span class="n">totalPopDensLower</span><span class="p">)</span> <span class="p">)</span>
    
                            <span class="c">#change in input parameters by a tiny amount 0.1% and run again</span>
                            <span class="c">#(this is a numerical bug in radex which fails sometimes)</span>
                            <span class="n">radexObj</span><span class="o">.</span><span class="n">inFile</span><span class="p">[</span><span class="s">&#39;tKin&#39;</span><span class="p">]</span>     <span class="o">=</span> <span class="n">inFileOrig</span><span class="p">[</span><span class="s">&#39;tKin&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="n">changeFac</span><span class="p">)</span>
                            <span class="n">radexObj</span><span class="o">.</span><span class="n">inFile</span><span class="p">[</span><span class="s">&#39;molnDens&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inFileOrig</span><span class="p">[</span><span class="s">&#39;molnDens&#39;</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="n">changeFac</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">dens</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">radexObj</span><span class="o">.</span><span class="n">inFile</span><span class="p">[</span><span class="s">&#39;nDensCollisionPartners&#39;</span><span class="p">]):</span>
                                <span class="n">radexObj</span><span class="o">.</span><span class="n">inFile</span><span class="p">[</span><span class="s">&#39;nDensCollisionPartners&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">inFileOrig</span><span class="p">[</span><span class="s">&#39;nDensCollisionPartners&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="n">changeFac</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">radexOutputMakesSense</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="k">print</span> <span class="s">&#39;====&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;pop dense make sense, trial </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">nTried</span>
                    <span class="k">else</span><span class="p">:</span> <span class="c"># radex did not succeed</span>
                        <span class="k">break</span>  <span class="c"># here radexOutputMakesSense woulbe be False</span>
                    
                    <span class="n">nTried</span> <span class="o">+=</span> <span class="mi">1</span>
                    
                    <span class="k">if</span> <span class="n">nTried</span> <span class="o">&gt;=</span> <span class="n">nMaxTrial</span><span class="p">:</span> <span class="c">#no meaningful output after nTried trials</span>
                        <span class="k">break</span> <span class="c"># here radexOutputMakesSense woulbe be False</span>
                        
                <span class="k">else</span><span class="p">:</span> <span class="c">#no need to check for validity of the radex pop densities</span>
                    <span class="n">radexOutputMakesSense</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">break</span>
            <span class="c">#------------------------------done running radex----------------------------------------</span>
            
            <span class="c">#setting the basic radex run info into the attribute</span>
            <span class="c">#-----------------------------------------------------------</span>
            <span class="c">#saving the number of transitions into radex info attribute</span>
            <span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
            <span class="k">if</span> <span class="n">radexObj</span><span class="o">.</span><span class="n">flagSet</span><span class="p">(</span><span class="s">&#39;ERROR&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">radexOutputMakesSense</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">):</span> <span class="c"># radex failed, no transition data available</span>
                <span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c">#no trainsitions</span>
                <span class="n">meshesRadex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
                <span class="n">radexObj</span><span class="o">.</span><span class="n">printSetFlags</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span> <span class="c"># radex succeeded, wirint the transition data</span>
                <span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">radexObj</span><span class="o">.</span><span class="n">nTransitions</span>
                <span class="n">meshesRadex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">radexObj</span><span class="o">.</span><span class="n">transitions</span><span class="p">)</span>

            <span class="c">#infoAllRadex[i][&#39;info&#39;][2] = NOT SET HERE, IT IS SET WHEN WRITING THE DB TO A FILE</span>
            
            <span class="c">#setting the status into the attribute</span>
            <span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>
            <span class="c">#appending the transition data of this mesh to the attribute </span>
            <span class="c">#-----------------finished saving the info------------------</span>
            
            
            <span class="k">if</span> <span class="n">radexObj</span><span class="o">.</span><span class="n">flagSet</span><span class="p">(</span><span class="s">&#39;SUCCESS&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;radexGrid : converged with no warnings&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;radexGrid : converged with warnings&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;------------------------------------&#39;</span><span class="p">)</span>
                <span class="k">print</span> <span class="n">radexObj</span><span class="o">.</span><span class="n">getWarnings</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;------------------------------------&#39;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;---------------------------------------------------------&#39;</span><span class="p">)</span>
            

        <span class="c">#copying the mesh parameters self.infoAll[:][&#39;parms] to self.infoAllRadex[:][&#39;parms&#39;]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span> <span class="p">):</span>
            <span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">][:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;parms&#39;</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">infoAllRadex</span> <span class="o">=</span> <span class="n">infoAllRadex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">meshesRadex</span> <span class="o">=</span> <span class="n">meshesRadex</span>
        
        <span class="k">if</span> <span class="n">writeDb</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">writeDbRadex</span><span class="p">()</span>
        
    </div>
<div class="viewcode-block" id="meshArxv.save_radex_grids"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.save_radex_grids">[docs]</a>    <span class="k">def</span> <span class="nf">save_radex_grids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relativeDirPath</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">basename</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">transitionInds</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> 
                         <span class="n">quantity</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">fileFormat</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;method that saves the radex grids (emission grids) for now into files.</span>
<span class="sd">        </span>
<span class="sd">           :param string fileFormat: When this is set to **&#39;numpytxt&#39;**, the grid </span>
<span class="sd">            is dumped written to an ascii file using numpy.savetxt, one row on </span>
<span class="sd">            each line.  When this parameter is set to **&#39;3column&#39;**, the </span>
<span class="sd">            coordinates of the centroid of the grid cell and the value </span>
<span class="sd">            (x_i, y_i, v_i) are written on each line.  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">ranges</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;plotRanges&#39;</span><span class="p">]</span> 
        <span class="n">res</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resPltGrids</span> 

        <span class="c">#self.set_default_attributes()</span>
        <span class="c">#self.set_grid_axes_quantity_values()</span>

        <span class="c">#dumping the parameters of meshutils used in generating the data</span>
        <span class="n">timeStr</span> <span class="o">=</span> <span class="n">ctime</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">parmsOutputFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span> <span class="o">+</span> <span class="n">relativeDirPath</span> <span class="o">+</span> <span class="s">&#39;parms.out&#39;</span> <span class="c">#-&#39; + timeStr </span>
        <span class="n">parmsOut</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">parmsOutputFile</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">,</span> <span class="n">parmsOut</span><span class="p">)</span>
        <span class="n">parmsOut</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="n">filesInfo</span> <span class="o">=</span> <span class="p">()</span>
        
        <span class="k">for</span> <span class="n">zSec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z_unique</span><span class="p">:</span>
            
            <span class="k">for</span> <span class="n">transitionIdx</span> <span class="ow">in</span> <span class="n">transitionInds</span><span class="p">:</span>
            
                <span class="n">nValidRadexInSec</span> <span class="o">=</span> <span class="mi">0</span> <span class="c"># number of meshes wiht radex data in this section</span>
    
                <span class="c">####################################################################################################################</span>
                <span class="c">#getting the inerpolation function for this section in z</span>
                <span class="c">####################################################################################################################</span>
                <span class="n">values</span><span class="p">,</span> <span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span><span class="p">,</span> <span class="n">grid_z</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
                
                <span class="c">#looping over all the radex info of all the mesehes and getting the</span>
                <span class="c">#transition data to be displayed</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">):</span>
                    
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshesRadex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                        
                        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshesRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">transitionIdx</span><span class="p">][</span><span class="n">quantity</span><span class="p">]</span>
                        
                        <span class="c"># appending the data and the value to a list to be used</span>
                        <span class="c"># in making the interpolation function</span>
                        
                        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">v</span> <span class="p">)</span>
                        <span class="n">grid_x</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span>
                        <span class="n">grid_y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">y</span> <span class="p">)</span>
                        <span class="n">grid_z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">z</span> <span class="p">)</span>
                        
                        <span class="c"># getting the transition string</span>
                        <span class="n">transStrng</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshesRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">transitionIdx</span><span class="p">][</span><span class="s">&#39;upper&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">meshesRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">transitionIdx</span><span class="p">][</span><span class="s">&#39;lower&#39;</span><span class="p">])</span>
                        <span class="n">nValidRadexInSec</span> <span class="o">+=</span> <span class="mi">1</span>
                
                <span class="k">if</span> <span class="n">nValidRadexInSec</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="c"># getting the data in the shape that is accepted by the interpolation construction        </span>
                    <span class="n">data</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">grid_x</span><span class="p">,</span> <span class="n">grid_y</span><span class="p">,</span> <span class="n">grid_z</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">values</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                    <span class="n">intensityGridInterp_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct3DInterpolationFunction</span><span class="p">(</span><span class="n">data</span>   <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
                                                                                  <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">,</span>
                                                                                  <span class="n">log10</span>  <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                                                                                  <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
                    <span class="c">####################################################################################################################</span>
                    <span class="c">#interpolating the grids</span>
                    <span class="c">####################################################################################################################</span>
                    
        
                    <span class="n">grd</span><span class="p">,</span> <span class="n">grdx</span><span class="p">,</span> <span class="n">grdy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeInterpolated2DGrid</span><span class="p">(</span><span class="n">ranges</span>   <span class="o">=</span> <span class="n">ranges</span><span class="p">,</span>
                                                                     <span class="n">res</span>      <span class="o">=</span> <span class="n">res</span><span class="p">,</span>  
                                                                     <span class="n">zSec</span>     <span class="o">=</span> <span class="n">zSec</span><span class="p">,</span> 
                                                                     <span class="n">fInterp</span>  <span class="o">=</span> <span class="n">intensityGridInterp_f</span><span class="p">,</span>
                                                                     <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                                                                
                    <span class="n">grd</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">T</span>
    
                    <span class="n">filename</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span> <span class="o">+</span> <span class="n">relativeDirPath</span> <span class="o">+</span> <span class="n">basename</span>
                    <span class="n">filename</span> <span class="o">+=</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="n">quantity</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="n">transStrng</span>
                    <span class="n">filename</span> <span class="o">+=</span> <span class="s">&#39;-log10zSec=</span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">zSec</span>
                    <span class="n">filename</span> <span class="o">+=</span> <span class="s">&#39;.txt&#39;</span>
                    
                    <span class="c">#------------setting the format of the data to be written to a text file--------</span>
                    <span class="k">if</span> <span class="n">fileFormat</span> <span class="o">==</span> <span class="s">&#39;numpytxt&#39;</span><span class="p">:</span> <span class="c">#writing the grid as a 2D table</span>
                        <span class="n">fileData</span> <span class="o">=</span> <span class="n">grd</span>
                    <span class="k">elif</span> <span class="n">fileFormat</span> <span class="o">==</span> <span class="s">&#39;3columns&#39;</span><span class="p">:</span>
                        <span class="n">n</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">size</span>
                        <span class="c"># converting the grids into a 3 column format </span>
                        <span class="n">fileData</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">grdx</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">grdy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">grd</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
                    <span class="c">#--------------------------------------------------------------------------------</span>
                    
                    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">fileData</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%1.4e</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;wrote the file </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
                    
                    <span class="n">thisFileInfo</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;zSec&#39;</span>       <span class="p">:</span> <span class="n">zSec</span><span class="p">,</span>
                                    <span class="s">&#39;transition&#39;</span> <span class="p">:</span> <span class="n">transStrng</span><span class="p">,</span>
                                    <span class="s">&#39;filename&#39;</span>   <span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                                    <span class="p">}</span>
                    <span class="n">filesInfo</span> <span class="o">+=</span> <span class="p">(</span><span class="n">thisFileInfo</span><span class="p">,)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&#39;no valid radex data found in this section&#39;</span><span class="p">)</span>
                    
        <span class="c">#dumping information about the files into a pickle file</span>
        <span class="n">fileInfoPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span> <span class="o">+</span> <span class="n">relativeDirPath</span> <span class="o">+</span> <span class="s">&#39;filesInfo.out&#39;</span> <span class="c">#-&#39; + timeStr</span>
        <span class="n">fileInfoFobj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileInfoPath</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">filesInfo</span><span class="p">,</span> <span class="n">fileInfoFobj</span><span class="p">)</span>
        <span class="n">fileInfoFobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="meshArxv.save_PDR_emission_grids"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.save_PDR_emission_grids">[docs]</a>    <span class="k">def</span> <span class="nf">save_PDR_emission_grids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relativeDirPath</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">basename</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">transitions</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;method that saves the emission grids computed from the PDR models (emission grids) for now into files&quot;&quot;&quot;</span>
        
        <span class="n">ranges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;plotRanges&#39;</span><span class="p">]</span> 
        <span class="n">res</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resPltGrids</span> 
        
        <span class="c">#dumping the parameters of meshutils used in generating the data</span>
        <span class="n">timeStr</span> <span class="o">=</span> <span class="n">ctime</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">parmsOutputFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span> <span class="o">+</span> <span class="n">relativeDirPath</span> <span class="o">+</span> <span class="s">&#39;parms.out&#39;</span> 
        <span class="n">parmsOut</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">parmsOutputFile</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">,</span> <span class="n">parmsOut</span><span class="p">)</span>
        <span class="n">parmsOut</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="n">filesInfo</span> <span class="o">=</span> <span class="p">()</span>

        <span class="n">specStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;quantity&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">quantity_PDR_em</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;fineStructureCoolingComponents&#39;</span><span class="p">,</span> <span class="n">specStr</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">]</span>
        
        <span class="c">#a temporary object used to calculate stuff from a pdr mesh object</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">mesh</span><span class="p">(</span><span class="n">chemNet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemNet</span><span class="p">,</span> <span class="n">metallicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metallicity</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">zSec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z_unique</span><span class="p">:</span>
            
            <span class="k">for</span> <span class="n">transStrng</span> <span class="ow">in</span> <span class="n">transitions</span><span class="p">:</span>
            
                <span class="c">####################################################################################################################</span>
                <span class="c">#getting the inerpolation function for this section in z</span>
                <span class="c">####################################################################################################################</span>

                <span class="n">values</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">quantity_PDR_em</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">transStrng</span> 
                
                <span class="c">#looping over all the radex info of all the mesehes and getting the</span>
                <span class="c">#transition data to be displayed</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="p">):</span>
                    
                    <span class="n">m</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                    <span class="n">dxSlabs</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">compute_dx</span><span class="p">()</span>
                    
                    <span class="n">q</span> <span class="o">=</span> <span class="n">fetchNestedDtypeValue</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">quantity_PDR_em</span> <span class="p">)</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span> <span class="n">q</span><span class="o">*</span><span class="n">dxSlabs</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;negative intensitiy detected - setting it to 0&#39;</span><span class="p">)</span>
                        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                        <span class="c">#print self.grid_x[i], self.grid_y[i], self.grid_z[i], v </span>

                    <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
                <span class="c">#--------done extracting the data from the meshes------- </span>
                
                <span class="c"># getting the data in the shape that is accepted by the interpolation construction        </span>
                <span class="n">data</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
                <span class="n">intensityGridInterp_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct3DInterpolationFunction</span><span class="p">(</span><span class="n">data</span>   <span class="o">=</span> <span class="n">data</span><span class="p">,</span>
                                                                              <span class="n">log10</span>  <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                                                                              <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">,</span>
                                                                              <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
                <span class="c">####################################################################################################################</span>
                <span class="c">#interpolating the grids</span>
                <span class="c">####################################################################################################################</span>
        
                <span class="n">grd</span><span class="p">,</span> <span class="n">grdx</span><span class="p">,</span> <span class="n">grdy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeInterpolated2DGrid</span><span class="p">(</span><span class="n">ranges</span>   <span class="o">=</span> <span class="n">ranges</span><span class="p">,</span>
                                                                 <span class="n">res</span>      <span class="o">=</span> <span class="n">res</span><span class="p">,</span>  
                                                                 <span class="n">zSec</span>     <span class="o">=</span> <span class="n">zSec</span><span class="p">,</span> 
                                                                 <span class="n">fInterp</span>  <span class="o">=</span> <span class="n">intensityGridInterp_f</span><span class="p">,</span>
                                                                 <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                                                                
                <span class="n">grd</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">T</span>

                <span class="n">filename</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span> <span class="o">+</span> <span class="n">relativeDirPath</span> <span class="o">+</span> <span class="n">basename</span>
                <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s">&#39;rate&#39;</span><span class="p">:</span> <span class="c"># just to make the filenames for emission the same as radex</span>
                    <span class="n">filename</span> <span class="o">+=</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="s">&#39;fluxcgs&#39;</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="n">transStrng</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">+=</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="n">quantity</span> <span class="o">+</span> <span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="n">transStrng</span>
                <span class="n">filename</span> <span class="o">+=</span> <span class="s">&#39;-log10zSec=</span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">zSec</span>
                <span class="n">filename</span> <span class="o">+=</span> <span class="s">&#39;.txt&#39;</span>
                    
                <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">grd</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%1.4e</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;wrote the file </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
                    
                <span class="n">thisFileInfo</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;zSec&#39;</span>       <span class="p">:</span> <span class="n">zSec</span><span class="p">,</span>
                                <span class="s">&#39;transition&#39;</span> <span class="p">:</span> <span class="n">transStrng</span><span class="p">,</span>
                                <span class="s">&#39;filename&#39;</span>   <span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                               <span class="p">}</span>
                <span class="n">filesInfo</span> <span class="o">+=</span> <span class="p">(</span><span class="n">thisFileInfo</span><span class="p">,)</span>
            <span class="c">#--------end loop over transitions-------------</span>
        <span class="c">#-----end loop over zSections------------</span>
        
        <span class="c">#dumping information about the files into a pickle file</span>
        <span class="n">fileInfoPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span> <span class="o">+</span> <span class="n">relativeDirPath</span> <span class="o">+</span> <span class="s">&#39;filesInfo.out&#39;</span><span class="c"># + timeStr</span>
        <span class="n">fileInfoFobj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileInfoPath</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">filesInfo</span><span class="p">,</span> <span class="n">fileInfoFobj</span><span class="p">)</span>
        <span class="n">fileInfoFobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="meshArxv.save_PDR_quantity_grids"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.save_PDR_quantity_grids">[docs]</a>    <span class="k">def</span> <span class="nf">save_PDR_quantity_grids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relativeDirPath</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">basename</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">slabIdx</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;method that saves a grid computed from the PDR models for now into files</span>
<span class="sd">        keywords : save, grid, pdr, quantity, slab</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">ranges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;plotRanges&#39;</span><span class="p">]</span> 
        <span class="n">res</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resPltGrids</span> 
        
        <span class="c">#dumping the parameters of meshutils used in generating the data</span>
        <span class="n">timeStr</span> <span class="o">=</span> <span class="n">ctime</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">parmsOutputFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span> <span class="o">+</span> <span class="n">relativeDirPath</span> <span class="o">+</span> <span class="s">&#39;parms.out&#39;</span> 
        <span class="n">parmsOut</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">parmsOutputFile</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">,</span> <span class="n">parmsOut</span><span class="p">)</span>
        <span class="n">parmsOut</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        
        <span class="n">filesInfo</span> <span class="o">=</span> <span class="p">()</span>
        
        <span class="k">for</span> <span class="n">zSec</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z_unique</span><span class="p">:</span>
            
            <span class="c">####################################################################################################################</span>
            <span class="c">#getting the inerpolation function for this section in z</span>
            <span class="c">####################################################################################################################</span>
            <span class="n">grdInterp_f</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct3DInterpolationFunction</span><span class="p">(</span><span class="n">quantity</span> <span class="o">=</span> <span class="n">quantity</span><span class="p">,</span> 
                                                                <span class="n">slabIdx</span>  <span class="o">=</span> <span class="n">slabIdx</span><span class="p">,</span>
                                                                <span class="n">log10</span>    <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                                                                <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="c">#--------done extracting the data from the meshes------- </span>
            
            <span class="c">####################################################################################################################</span>
            <span class="c">#interpolating the grids</span>
            <span class="c">####################################################################################################################</span>
    
            <span class="n">grd</span><span class="p">,</span> <span class="n">grdx</span><span class="p">,</span> <span class="n">grdy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">computeInterpolated2DGrid</span><span class="p">(</span><span class="n">ranges</span>   <span class="o">=</span> <span class="n">ranges</span><span class="p">,</span>
                                                             <span class="n">res</span>      <span class="o">=</span> <span class="n">res</span><span class="p">,</span>  
                                                             <span class="n">zSec</span>     <span class="o">=</span> <span class="n">zSec</span><span class="p">,</span> 
                                                             <span class="n">fInterp</span>  <span class="o">=</span> <span class="n">grdInterp_f</span><span class="p">,</span>
                                                             <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                                                            
            <span class="n">grd</span> <span class="o">=</span> <span class="n">grd</span><span class="o">.</span><span class="n">T</span>

            <span class="n">filename</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span> <span class="o">+</span> <span class="n">relativeDirPath</span> <span class="o">+</span> <span class="n">basename</span>
            <span class="n">filename</span> <span class="o">+=</span> <span class="s">&#39;-log10zSec=</span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">zSec</span>
            <span class="n">filename</span> <span class="o">+=</span> <span class="s">&#39;-</span><span class="si">%d</span><span class="s">-&#39;</span> <span class="o">%</span> <span class="n">slabIdx</span>
            <span class="n">filename</span> <span class="o">+=</span> <span class="s">&#39;.txt&#39;</span>
                
            <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">grd</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%1.4e</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;wrote the file </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>
                
            <span class="n">thisFileInfo</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;zSec&#39;</span>       <span class="p">:</span> <span class="n">zSec</span><span class="p">,</span>
                            <span class="s">&#39;slabIdx&#39;</span>    <span class="p">:</span> <span class="n">slabIdx</span><span class="p">,</span> 
                            <span class="s">&#39;filename&#39;</span>   <span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
                           <span class="p">}</span>
            <span class="n">filesInfo</span> <span class="o">+=</span> <span class="p">(</span><span class="n">thisFileInfo</span><span class="p">,)</span>
        <span class="c">#-----end loop over zSections------------</span>
        
        <span class="c">#dumping information about the files into a pickle file</span>
        <span class="n">fileInfoPath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirPath</span> <span class="o">+</span> <span class="n">relativeDirPath</span> <span class="o">+</span> <span class="s">&#39;filesInfo.out&#39;</span><span class="c"># + timeStr</span>
        <span class="n">fileInfoFobj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileInfoPath</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">filesInfo</span><span class="p">,</span> <span class="n">fileInfoFobj</span><span class="p">)</span>
        <span class="n">fileInfoFobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    
    <span class="c">#################################################################################</span></div>
<div class="viewcode-block" id="meshArxv.setupGui"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.setupGui">[docs]</a>    <span class="k">def</span> <span class="nf">setupGui</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;the method which setup the layout of the gui by defining a dict holding</span>
<span class="sd">        all the object and variables related to it. Returns the dict object and make</span>
<span class="sd">        use of self.parms&quot;&quot;&quot;</span>
        
        <span class="n">gui</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">pyl</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">14</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;widgets&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span> 
        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;maps2d&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="p">{}</span> <span class="c"># the grids for a certain section</span>
        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;ax2d&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="p">{}</span> <span class="c"># the mesh points in a certain section</span>
        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;ax3d&#39;</span><span class="p">]</span>    <span class="o">=</span> <span class="p">{}</span> <span class="c"># all the mehs points in 3D</span>
        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;AV&#39;</span><span class="p">]</span>      <span class="o">=</span> <span class="p">{}</span> <span class="c"># plots as a function of Av for a certail slab</span>
        
        <span class="c"># the grid plot in n,G0 showing the points where models are present in the section</span>
        <span class="n">ax2d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c">#-----------------------------------------------------------------------------------</span>
        <span class="n">ax2d</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">ax2d</span><span class="p">[</span><span class="s">&#39;pts1&#39;</span><span class="p">],</span> <span class="o">=</span> <span class="n">ax2d</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax2d</span><span class="p">[</span><span class="s">&#39;pts2&#39;</span><span class="p">],</span> <span class="o">=</span> <span class="n">ax2d</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax2d</span><span class="p">[</span><span class="s">&#39;pts3&#39;</span><span class="p">],</span> <span class="o">=</span> <span class="n">ax2d</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s">&#39;w&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">ax2d</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;$\log_{10} n_{gas} = $ </span><span class="si">%4.2f</span><span class="se">\n</span><span class="s">$\log_{10} G_0 =$ </span><span class="si">%4.2f</span><span class="se">\n</span><span class="s">$\log_{10} \Gamma_{mech} = $  </span><span class="si">%5.2f</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span>
        <span class="n">ax2d</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;plotRanges&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ax2d</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;plotRanges&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax2d</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;$log_{10} n_{gas}$&#39;</span><span class="p">)</span>
        <span class="n">ax2d</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;$log_{10} G_0$&#39;</span><span class="p">)</span>
        <span class="c">#-----------------------------------------------------------------------------------        </span>
        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;ax2d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax2d</span>

        <span class="c"># the axes to plot in the 3D grid (default axes are n,G0,gmech) showing the points</span>
        <span class="c"># where models are present in the database</span>
        <span class="n">ax3d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c">#-----------------------------------------------------------------------------------</span>
        <span class="n">ax3d</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s">&#39;3d&#39;</span><span class="p">)</span>
        <span class="n">ax3d</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.68</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
        <span class="c">#-----------------------------------------------------------------------------------        </span>
        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;ax3d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax3d</span>
                        
        <span class="c"># defining the axes which will be used to select the section in Z to show</span>
        <span class="n">zSecSelector</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c">#----------------------------------------------------------------------</span>
        <span class="n">zSecSelector</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">zSecSelector</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;z section selector&#39;</span><span class="p">)</span>
        <span class="n">zSecSelector</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="p">]</span> <span class="p">)</span>
        <span class="n">zSecSelector</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">zSecSelector</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
        <span class="n">zSecSelector</span><span class="p">[</span><span class="s">&#39;point&#39;</span><span class="p">],</span> <span class="o">=</span> <span class="n">zSecSelector</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span> <span class="s">&#39;r+&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
        <span class="n">zSecSelector</span><span class="p">[</span><span class="s">&#39;point&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltGmSec</span> <span class="p">)</span>
        <span class="n">zSecSelector</span><span class="p">[</span><span class="s">&#39;point&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span> <span class="mf">0.5</span> <span class="p">)</span>
        <span class="n">zSecSelector</span><span class="p">[</span><span class="s">&#39;pointsUnique&#39;</span><span class="p">],</span> <span class="o">=</span> <span class="n">zSecSelector</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span> <span class="s">&#39;yo&#39;</span><span class="p">)</span>
        <span class="c">#----------------------------------------------------------------------</span>
        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;widgets&#39;</span><span class="p">][</span><span class="s">&#39;zSecSelector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zSecSelector</span>

        <span class="c"># defining the axes which will be used to select the transition index to be displayed in the emission panel</span>
        <span class="n">transitionSelector</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c">#----------------------------------------------------------------------</span>
        <span class="n">transitionSelector</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">transitionSelector</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;transition selector&#39;</span><span class="p">)</span>
        <span class="n">transitionSelector</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">transitionSelector</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">transitionSelector</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
        <span class="n">transitionSelector</span><span class="p">[</span><span class="s">&#39;point&#39;</span><span class="p">],</span> <span class="o">=</span> <span class="n">transitionSelector</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span> <span class="s">&#39;r+&#39;</span><span class="p">,</span> <span class="n">markersize</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;radex&#39;</span><span class="p">:</span>
            <span class="n">transitionSelector</span><span class="p">[</span><span class="s">&#39;point&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;transitionIndx&#39;</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">transitionSelector</span><span class="p">[</span><span class="s">&#39;point&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span> <span class="mf">0.5</span> <span class="p">)</span>
        <span class="c">#----------------------------------------------------------------------</span>
        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;widgets&#39;</span><span class="p">][</span><span class="s">&#39;transitionSelector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transitionSelector</span>
        
        <span class="c"># defining the grid where the maps will be plotted (maps2d)</span>
        <span class="c">#----------------------------------------------------------</span>
        <span class="n">left</span>  <span class="o">=</span> <span class="mf">0.55</span>
        <span class="n">bott</span>  <span class="o">=</span> <span class="mf">0.45</span>
        <span class="n">sz</span>    <span class="o">=</span> <span class="mf">0.20</span>
        <span class="n">vSpace</span> <span class="o">=</span> <span class="mf">0.06</span>
        <span class="n">hSpace</span> <span class="o">=</span> <span class="mf">0.02</span>
        
        <span class="c"># 0,0</span>
        <span class="n">maps2d_00</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">maps2d_00</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bott</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">vSpace</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">sz</span><span class="p">])</span>
        <span class="n">maps2d_00</span><span class="p">[</span><span class="s">&#39;axesCbar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bott</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">vSpace</span> <span class="o">+</span> <span class="mf">0.017</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.01</span> <span class="p">])</span>
        <span class="n">maps2d_00</span><span class="p">[</span><span class="s">&#39;axesCbar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;00&#39;</span><span class="p">][</span><span class="s">&#39;quantity&#39;</span><span class="p">])</span> <span class="p">)</span>
        <span class="n">maps2d_00</span><span class="p">[</span><span class="s">&#39;contour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">maps2d_00</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span> <span class="s">&#39;$log_{10} G_0$&#39;</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">maps2d_00</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
            <span class="n">tick</span><span class="o">.</span><span class="n">label1On</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">maps2d_00</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">maps2d_00</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;maps2d&#39;</span><span class="p">][</span><span class="s">&#39;00&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maps2d_00</span> 
        
        <span class="c"># 0,1</span>
        <span class="n">maps2d_01</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">maps2d_01</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">hSpace</span><span class="p">,</span> <span class="n">bott</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">vSpace</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">sz</span><span class="p">])</span>
        <span class="n">maps2d_01</span><span class="p">[</span><span class="s">&#39;axesCbar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span> <span class="p">[</span><span class="n">left</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">hSpace</span><span class="p">,</span> <span class="n">bott</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">vSpace</span> <span class="o">+</span> <span class="mf">0.017</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">maps2d_01</span><span class="p">[</span><span class="s">&#39;axesCbar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;$n_X/(n_H + 2 n_{H_2}$&#39;</span><span class="p">)</span>
        <span class="n">maps2d_01</span><span class="p">[</span><span class="s">&#39;contour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">maps2d_01</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
            <span class="n">tick</span><span class="o">.</span><span class="n">label1On</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">maps2d_01</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
            <span class="n">tick</span><span class="o">.</span><span class="n">label1On</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">maps2d_00</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">maps2d_00</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;maps2d&#39;</span><span class="p">][</span><span class="s">&#39;01&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maps2d_01</span> 
        
        <span class="c"># 1,0</span>
        <span class="n">maps2d_10</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">maps2d_10</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bott</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">sz</span><span class="p">])</span>
        <span class="n">maps2d_10</span><span class="p">[</span><span class="s">&#39;axesCbar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bott</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">+</span> <span class="mf">0.017</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.01</span> <span class="p">])</span>
        <span class="n">maps2d_10</span><span class="p">[</span><span class="s">&#39;axesCbar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;N(X)&#39;</span><span class="p">)</span>
        <span class="n">maps2d_10</span><span class="p">[</span><span class="s">&#39;contour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">maps2d_10</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span> <span class="s">&#39;$log_{10} n_{gas}$&#39;</span> <span class="p">)</span>
        <span class="n">maps2d_10</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span> <span class="s">&#39;$log_{10} G_0$&#39;</span> <span class="p">)</span>
        <span class="n">maps2d_10</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">maps2d_10</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">(</span><span class="n">maps2d_10</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label1On</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="p">(</span><span class="n">maps2d_10</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">())[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">label1On</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;maps2d&#39;</span><span class="p">][</span><span class="s">&#39;10&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maps2d_10</span> 
        
        <span class="c"># 1,1</span>
        <span class="n">maps2d_11</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">maps2d_11</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">hSpace</span><span class="p">,</span> <span class="n">bott</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">sz</span><span class="p">])</span>
        <span class="n">maps2d_11</span><span class="p">[</span><span class="s">&#39;axesCbar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span> <span class="p">[</span><span class="n">left</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">hSpace</span><span class="p">,</span> <span class="n">bott</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">+</span> <span class="mf">0.017</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;radex&#39;</span><span class="p">:</span>
            <span class="n">maps2d_11</span><span class="p">[</span><span class="s">&#39;axesCbar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Intensity </span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;specStr&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;transitionIndx&#39;</span><span class="p">])</span>  <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;pdr&#39;</span><span class="p">:</span>
            <span class="n">maps2d_11</span><span class="p">[</span><span class="s">&#39;axesCbar&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Intensity </span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;quantity&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;quantity&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">])</span> <span class="p">)</span>
        <span class="n">maps2d_11</span><span class="p">[</span><span class="s">&#39;contour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">maps2d_11</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span> <span class="s">&#39;$log_{10} n_{gas}$&#39;</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">maps2d_11</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
            <span class="n">tick</span><span class="o">.</span><span class="n">label1On</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">maps2d_11</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">maps2d_11</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;maps2d&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maps2d_11</span> 
        
        
        <span class="c"># modifying ticks on the colorbars   </span>
        <span class="k">for</span> <span class="n">cbarAxs</span> <span class="ow">in</span> <span class="p">[</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;maps2d&#39;</span><span class="p">][</span><span class="s">&#39;00&#39;</span><span class="p">][</span><span class="s">&#39;axesCbar&#39;</span><span class="p">],</span>
                        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;maps2d&#39;</span><span class="p">][</span><span class="s">&#39;01&#39;</span><span class="p">][</span><span class="s">&#39;axesCbar&#39;</span><span class="p">],</span>
                        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;maps2d&#39;</span><span class="p">][</span><span class="s">&#39;10&#39;</span><span class="p">][</span><span class="s">&#39;axesCbar&#39;</span><span class="p">],</span>
                        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;maps2d&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;axesCbar&#39;</span><span class="p">]]:</span>
            <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">cbarAxs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
                <span class="n">tick</span><span class="o">.</span><span class="n">label1On</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">tick</span><span class="o">.</span><span class="n">label2On</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">cbarAxs</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_major_ticks</span><span class="p">():</span>
                <span class="n">tick</span><span class="o">.</span><span class="n">label1On</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">tick</span><span class="o">.</span><span class="n">label2On</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="c"># the axes to plot in the mesh stuff as a function of AV.</span>
        <span class="n">AV</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c">#-----------------------------------------------------------------------------------</span>
        <span class="n">left</span>  <span class="o">=</span> <span class="mf">0.10</span>
        <span class="n">bott</span>  <span class="o">=</span> <span class="mf">0.035</span>
        <span class="n">sz</span>    <span class="o">=</span> <span class="mf">0.20</span>
        <span class="n">vSpace</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">hSpace</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">AV</span><span class="p">[</span><span class="s">&#39;00&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;axes&#39;</span> <span class="p">:</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span>              <span class="p">,</span> <span class="n">bott</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">vSpace</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">sz</span><span class="p">])}</span>
        <span class="n">AV</span><span class="p">[</span><span class="s">&#39;01&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;axes&#39;</span> <span class="p">:</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">hSpace</span><span class="p">,</span> <span class="n">bott</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">vSpace</span><span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">sz</span><span class="p">])}</span>
        <span class="n">AV</span><span class="p">[</span><span class="s">&#39;10&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;axes&#39;</span> <span class="p">:</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span>              <span class="p">,</span> <span class="n">bott</span>              <span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">sz</span><span class="p">])}</span>
        <span class="n">AV</span><span class="p">[</span><span class="s">&#39;11&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;axes&#39;</span> <span class="p">:</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span> <span class="o">+</span> <span class="n">sz</span> <span class="o">+</span> <span class="n">hSpace</span><span class="p">,</span> <span class="n">bott</span>              <span class="p">,</span> <span class="n">sz</span><span class="p">,</span> <span class="n">sz</span><span class="p">])}</span>
        <span class="c">#-----------------------------------------------------------------------------------        </span>
        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;AV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">AV</span>


        <span class="c"># the axes stuff where the radex output wil be plotted</span>
        <span class="n">radex</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c">#-----------------------------------------------------------------------------------</span>
        <span class="n">left</span>  <span class="o">=</span> <span class="mf">0.65</span>
        <span class="n">bott</span>  <span class="o">=</span> <span class="mf">0.07</span>
        <span class="n">sz</span>    <span class="o">=</span> <span class="mf">0.08</span>
        <span class="n">vSpace</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">radex</span><span class="p">[</span><span class="s">&#39;0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;axes&#39;</span> <span class="p">:</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bott</span> <span class="o">+</span> <span class="mi">3</span><span class="o">*</span><span class="n">sz</span> <span class="o">+</span> <span class="n">vSpace</span> <span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">sz</span><span class="p">,</span> <span class="n">sz</span><span class="p">])}</span>
        <span class="n">radex</span><span class="p">[</span><span class="s">&#39;1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;axes&#39;</span> <span class="p">:</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bott</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">sz</span> <span class="o">+</span> <span class="n">vSpace</span> <span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">sz</span><span class="p">,</span> <span class="n">sz</span><span class="p">])}</span>
        <span class="n">radex</span><span class="p">[</span><span class="s">&#39;2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;axes&#39;</span> <span class="p">:</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bott</span> <span class="o">+</span> <span class="mi">1</span><span class="o">*</span><span class="n">sz</span> <span class="o">+</span> <span class="n">vSpace</span> <span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">sz</span><span class="p">,</span> <span class="n">sz</span><span class="p">])}</span>
        <span class="n">radex</span><span class="p">[</span><span class="s">&#39;3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;axes&#39;</span> <span class="p">:</span> <span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bott</span> <span class="o">+</span> <span class="mi">0</span><span class="o">*</span><span class="n">sz</span>          <span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">sz</span><span class="p">,</span> <span class="n">sz</span><span class="p">])}</span>
        <span class="n">radex</span><span class="p">[</span><span class="s">&#39;title1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pyl</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.65</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">radex</span><span class="p">[</span><span class="s">&#39;title2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pyl</span><span class="o">.</span><span class="n">figtext</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.2</span> <span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="c">#-----------------------------------------------------------------------------------        </span>
        <span class="n">gui</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">radex</span>
        
        <span class="c">#-------------------------------------------------</span>
        <span class="k">return</span> <span class="n">gui</span>
    
        </div>
<div class="viewcode-block" id="meshArxv.plotGrids"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.plotGrids">[docs]</a>    <span class="k">def</span> <span class="nf">plotGrids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Main method for exploring the meshes in the database.</span>
<span class="sd">        </span>
<span class="sd">           .. todo:: change resGrids to a [res_x, res_y] insteads of it being just a scalar.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_default_attributes</span><span class="p">()</span>
        
        <span class="n">resGrids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsRes&#39;</span><span class="p">]</span>
        <span class="c">#setting the default zSec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pltGmSec</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;set the current plotting section to </span><span class="si">%f</span><span class="s">, the minimum of the self.grid_z&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltGmSec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radexParms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">]</span>
        
        <span class="c">#setting up the gui attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setupGui</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;showGrids&#39;</span><span class="p">]:</span>
            <span class="c"># getting the interpolation function which will be used to display the 2D grids</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">computeAndSetInterpolationFunctions</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>        
    
            <span class="c"># defining and intialising the ndmesh objects which will be used</span>
            <span class="c"># for computing the grid properties and then displayed                                </span>
                                    <span class="c">#xaxis    yaxis </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grds</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="n">ndmesh</span><span class="p">(</span> <span class="p">(</span><span class="n">resGrids</span><span class="p">,</span> <span class="n">resGrids</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">ranges</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">fill</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="p">),</span> 
                           <span class="n">ndmesh</span><span class="p">(</span> <span class="p">(</span><span class="n">resGrids</span><span class="p">,</span> <span class="n">resGrids</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">ranges</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">fill</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="p">)],</span> 
                          <span class="p">[</span><span class="n">ndmesh</span><span class="p">(</span> <span class="p">(</span><span class="n">resGrids</span><span class="p">,</span> <span class="n">resGrids</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">ranges</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">fill</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="p">),</span>
                           <span class="n">ndmesh</span><span class="p">(</span> <span class="p">(</span><span class="n">resGrids</span><span class="p">,</span> <span class="n">resGrids</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">ranges</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">fill</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="p">)]</span> <span class="p">]</span>  
    
            <span class="bp">self</span><span class="o">.</span><span class="n">resPltGrids</span> <span class="o">=</span> <span class="p">[</span><span class="n">resGrids</span><span class="p">,</span> <span class="n">resGrids</span><span class="p">]</span> 
         
        <span class="c"># setting up a dummy mesh object to use its plotting functionalities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span> <span class="o">=</span> <span class="n">mesh</span><span class="p">(</span><span class="n">chemNet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemNet</span><span class="p">,</span> <span class="n">metallicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metallicity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">setFigureObjects</span><span class="p">(</span><span class="n">figObj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">],</span> 
                                     <span class="n">axObj</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                                                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;AV&#39;</span><span class="p">][</span><span class="s">&#39;00&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;AV&#39;</span><span class="p">][</span><span class="s">&#39;01&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">]],</span>
                                                        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;AV&#39;</span><span class="p">][</span><span class="s">&#39;10&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;AV&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">]]</span>
                                                        <span class="p">])</span>
                                     <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">setupFigures</span><span class="p">(</span><span class="n">plot_Av_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;meshPltAvRng&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">set_metallicity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">metallicity</span><span class="p">)</span>

        <span class="c"># plotting all the points in the archive in 3D</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_3D_grid_points</span><span class="p">(</span><span class="n">figure</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">],</span> 
                                 <span class="n">axes</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;ax3d&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">],</span> 
                                 <span class="n">ranges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ranges</span><span class="p">)</span>
        
        <span class="c"># setting up the axes to plot the radex output for each selected model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pltRadex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;0&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">],</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;1&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">],</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;2&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">],</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;3&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">]</span>
                                  <span class="p">]</span>
                                 <span class="p">)</span>
        
        <span class="c"># getting and plotting the unique sections in z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_z_unique</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getUnique_grid_z_sections</span><span class="p">(</span><span class="mf">1e-13</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;widgets&#39;</span><span class="p">][</span><span class="s">&#39;zSecSelector&#39;</span><span class="p">][</span><span class="s">&#39;pointsUnique&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z_unique</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;widgets&#39;</span><span class="p">][</span><span class="s">&#39;zSecSelector&#39;</span><span class="p">][</span><span class="s">&#39;pointsUnique&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z_unique</span><span class="o">*</span><span class="mf">0.0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>

        <span class="c"># attaching mouse click event to fig 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;button_press_event&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_b1_down</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">plotThisSec</span><span class="p">()</span>
        
        <span class="c"># displaying</span>
        <span class="n">pyl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;browing data....&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="meshArxv.plotThisSec"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.plotThisSec">[docs]</a>    <span class="k">def</span> <span class="nf">plotThisSec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;updates the plotes once the z section value is changed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;updating the grids for zSec = </span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltGmSec</span><span class="p">)</span>

        <span class="c">#plotting the meshes n and G0 whose data is available for</span>
        <span class="c">#this section</span>
        <span class="n">indsThisSec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltGmSec</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-13</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>            
        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;ax2d&#39;</span><span class="p">][</span><span class="s">&#39;pts1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="p">[</span><span class="n">indsThisSec</span><span class="p">]</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;ax2d&#39;</span><span class="p">][</span><span class="s">&#39;pts1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="p">[</span><span class="n">indsThisSec</span><span class="p">]</span> <span class="p">)</span>
        
        <span class="c">#overplotting the radex points available for this section</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
            <span class="n">cond1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltGmSec</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-13</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">cond1</span><span class="o">.</span><span class="n">size</span><span class="p">):</span> 
                <span class="n">c0</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">infoAllRadex</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;info&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">cond1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">c0</span>
            <span class="n">indsThisSec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span> <span class="n">cond1</span> <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;ax2d&#39;</span><span class="p">][</span><span class="s">&#39;pts3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="p">[</span><span class="n">indsThisSec</span><span class="p">]</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;ax2d&#39;</span><span class="p">][</span><span class="s">&#39;pts3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="p">[</span><span class="n">indsThisSec</span><span class="p">]</span> <span class="p">)</span>
        
        <span class="c"># plotting the grids</span>
        <span class="c">#-------------------</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;showGrids&#39;</span><span class="p">]:</span>
            <span class="c"># temperature grid (top left grid)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;00&#39;</span><span class="p">][</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_pdr_mesh_quantity_grid</span><span class="p">(</span><span class="n">ranges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;plotRanges&#39;</span><span class="p">],</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resPltGrids</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
            <span class="c"># abundances (top left grid)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;01&#39;</span><span class="p">][</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">showAbundancesGrid</span><span class="p">(</span><span class="n">ranges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;plotRanges&#39;</span><span class="p">],</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resPltGrids</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
            <span class="c"># column densities (bottom left grid)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;10&#39;</span><span class="p">][</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">showColumnDensityGrid</span><span class="p">(</span><span class="n">ranges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;plotRanges&#39;</span><span class="p">],</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resPltGrids</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
            <span class="c"># line intensity (bottom right grid)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;show&#39;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">showLineIntensityGrid</span><span class="p">(</span><span class="n">ranges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;plotRanges&#39;</span><span class="p">],</span> <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resPltGrids</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="meshArxv.on_b1_down"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.on_b1_down">[docs]</a>    <span class="k">def</span> <span class="nf">on_b1_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;method called on the event of a mouse button down in self.fig. See self.setupGui()</span>
<span class="sd">           for the layout of the window.</span>
<span class="sd">        &quot;&quot;&quot;</span>
       
        <span class="n">ti</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

        <span class="c"># get the x and y coords, flip y from top to bottom</span>
        <span class="n">xd</span><span class="p">,</span> <span class="n">yd</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>
        
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

            <span class="n">clickedInAxes</span> <span class="o">=</span> <span class="bp">False</span>
            
            <span class="c"># getting the value of the section in z to display</span>
            <span class="c">#---------------------------------------------------------------</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;widgets&#39;</span><span class="p">][</span><span class="s">&#39;zSecSelector&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">event</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">clickedInAxes</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="c"># setting the section closest to the data available</span>
                <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">-</span> <span class="n">xd</span> <span class="p">)</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">pltGmSec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;widgets&#39;</span><span class="p">][</span><span class="s">&#39;zSecSelector&#39;</span><span class="p">][</span><span class="s">&#39;point&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltGmSec</span> <span class="p">)</span>
                <span class="c"># updating the title</span>
                <span class="n">newTitle</span> <span class="o">=</span> <span class="s">&#39;z section selector : </span><span class="si">%f</span><span class="s"> (</span><span class="si">%e</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pltGmSec</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">pltGmSec</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;widgets&#39;</span><span class="p">][</span><span class="s">&#39;zSecSelector&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">newTitle</span><span class="p">)</span>
                                
                <span class="c">#for all the axes of the 2d maps</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;showGrids&#39;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;maps2d&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                        <span class="c">#deleting the countour lines (if they are found)</span>
                        <span class="k">if</span> <span class="s">&#39;collections&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">panel</span><span class="p">[</span><span class="s">&#39;contour&#39;</span><span class="p">]):</span>
                            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;contour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
                                <span class="n">paths</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_paths</span><span class="p">()</span>
                                <span class="k">del</span> <span class="n">paths</span><span class="p">[:]</span>
                            <span class="c">#deleting the labels</span>
                            <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;contour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">labelTexts</span><span class="p">:</span>
                                <span class="n">txt</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                        <span class="c">#deleting the images</span>
                        <span class="k">del</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">images</span><span class="p">[:]</span>
                    
                <span class="bp">self</span><span class="o">.</span><span class="n">plotThisSec</span><span class="p">()</span> <span class="c">#;;; rename this to update 2D grids</span>
                <span class="n">pyl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

            <span class="c"># getting the value of the transition to display in the emission panel</span>
            <span class="c">#----------------------------------------------------------------------</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;widgets&#39;</span><span class="p">][</span><span class="s">&#39;transitionSelector&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">event</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">clickedInAxes</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="c"># setting the section closest to the data available</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;transitionIndx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">xd</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;widgets&#39;</span><span class="p">][</span><span class="s">&#39;transitionSelector&#39;</span><span class="p">][</span><span class="s">&#39;point&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;transitionIndx&#39;</span><span class="p">]</span> <span class="p">)</span>
                <span class="c"># updating the title</span>
                <span class="n">newTitle</span> <span class="o">=</span> <span class="s">&#39;transition selector, index = </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;transitionIndx&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;widgets&#39;</span><span class="p">][</span><span class="s">&#39;transitionSelector&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">newTitle</span><span class="p">)</span>

                <span class="c">#for all the axes of the 2d maps</span>
                <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;maps2d&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                    <span class="c">#deleting the countour lines (if they are found)</span>
                    <span class="k">if</span> <span class="s">&#39;collections&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">panel</span><span class="p">[</span><span class="s">&#39;contour&#39;</span><span class="p">]):</span>
                        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;contour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">collections</span><span class="p">:</span>
                            <span class="n">paths</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_paths</span><span class="p">()</span>
                            <span class="k">del</span> <span class="n">paths</span><span class="p">[:]</span>
                        <span class="c">#deleting the labels</span>
                        <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;contour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">labelTexts</span><span class="p">:</span>
                            <span class="n">txt</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                    <span class="c">#deleting the images</span>
                    <span class="k">del</span> <span class="n">panel</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">images</span><span class="p">[:]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">computeAndSetInterpolationFunctions</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">plotThisSec</span><span class="p">()</span> <span class="c">#;;; rename this to update 2D grids</span>
                <span class="n">pyl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

            <span class="c"># getting the coordinates inthe grid to display as a single mesh as a function of Av</span>
            <span class="c"># and maybe display the radex calculations</span>
            <span class="c">#------------------------------------------------------------------------------------                </span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;ax2d&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">event</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">clickedInAxes</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;####################################button 1 clicked###########################################&#39;</span><span class="p">)</span>
                <span class="n">indMin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mesh_index</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">xd</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">yd</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltGmSec</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="p">[</span><span class="n">indMin</span><span class="p">]</span> <span class="p">)</span>
                
                <span class="c">#updating the title of [&#39;ax2d&#39;][&#39;axes&#39;]</span>
                <span class="n">strng</span> <span class="o">=</span> <span class="s">&#39;$\log_{10} n_{gas} = $ </span><span class="si">%4.2f</span><span class="se">\n</span><span class="s">$\log_{10} G_0 =$ </span><span class="si">%4.2f</span><span class="se">\n</span><span class="s">$\log_{10} \Gamma_{mech} = $  </span><span class="si">%5.2f</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span>  <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;nGas&#39;</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;G0&#39;</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;gammaMech&#39;</span><span class="p">]))</span>
                <span class="n">strng</span> <span class="o">+=</span> <span class="s">&#39;$\Gamma_{mech}$ = </span><span class="si">%.2e</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;gammaMech&#39;</span><span class="p">]</span>   
                <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;ax2d&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">strng</span><span class="p">)</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;ax2d&#39;</span><span class="p">][</span><span class="s">&#39;pts2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="p">[</span><span class="n">indMin</span><span class="p">]</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;ax2d&#39;</span><span class="p">][</span><span class="s">&#39;pts2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="p">[</span><span class="n">indMin</span><span class="p">]</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;ax2d&#39;</span><span class="p">][</span><span class="s">&#39;pts2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
                                    
                <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span> <span class="c">#plotting the PDR mesh curves in the panels</span>
                                    
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;use&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">computeAndSetRadexCurves</span><span class="p">(</span><span class="n">meshObj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="p">)</span>
                
                <span class="c">#;;;remove later (to plot the emissions along the grid)</span>
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                pyl.figure(figsize=(6,6))</span>
<span class="sd">                pyl.plot(self.mshTmp.data[&#39;state&#39;][&#39;Av&#39;],</span>
<span class="sd">                         self.mshTmp.data[&#39;fineStructureCoolingComponents&#39;][&#39;C&#39;][&#39;rate&#39;][&#39;1-0&#39;],&#39;r&#39;)</span>
<span class="sd">                pyl.plot(self.mshTmp.data[&#39;state&#39;][&#39;Av&#39;],</span>
<span class="sd">                         self.mshTmp.data[&#39;fineStructureCoolingComponents&#39;][&#39;C&#39;][&#39;rate&#39;][&#39;2-1&#39;],&#39;b&#39;)</span>
<span class="sd">                &quot;&quot;&quot;</span>
                <span class="c">#;;;end remove later</span>
                <span class="n">pyl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

            <span class="c"># setting the Av of the position clicked on the plots of the current mesh</span>
            <span class="c"># to the chemical netowrk object.</span>
            <span class="c">#----------------------------------------------------------------------------</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;AV&#39;</span><span class="p">][</span><span class="s">&#39;00&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">event</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;AV&#39;</span><span class="p">][</span><span class="s">&#39;01&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">event</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;AV&#39;</span><span class="p">][</span><span class="s">&#39;10&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">event</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;AV&#39;</span><span class="p">][</span><span class="s">&#39;11&#39;</span><span class="p">][</span><span class="s">&#39;axes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">event</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                
                <span class="n">clickedInAxes</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">Av_clicked</span> <span class="o">=</span> <span class="n">xd</span>
                <span class="n">chemNet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">chemNet</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;####################################button 1 clicked###########################################&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Av clicked = </span><span class="si">%.4f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">Av_clicked</span><span class="p">)</span>
                
                <span class="c">#getting the index along the mesh which is closest in Av to the place</span>
                <span class="c">#where the mouse was clicked, the closes values will be used in the</span>
                <span class="c">#chemical netowrk of the mesh</span>
                <span class="n">mshAv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;state&#39;</span><span class="p">][</span><span class="s">&#39;Av&#39;</span><span class="p">]</span>
                <span class="n">indAv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">fabs</span><span class="p">(</span><span class="n">mshAv</span> <span class="o">-</span> <span class="n">Av_clicked</span><span class="p">)</span> <span class="p">)</span>
                
                <span class="c">#the values to be assigned to the chemical network</span>
                <span class="n">Av_use</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;state&#39;</span><span class="p">][</span><span class="s">&#39;Av&#39;</span><span class="p">][</span><span class="n">indAv</span><span class="p">]</span>
                <span class="n">gasT_use</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;state&#39;</span><span class="p">][</span><span class="s">&#39;gasT&#39;</span><span class="p">][</span><span class="n">indAv</span><span class="p">]</span>
                <span class="n">dustT_use</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;state&#39;</span><span class="p">][</span><span class="s">&#39;dustT&#39;</span><span class="p">][</span><span class="n">indAv</span><span class="p">]</span>
                <span class="n">beta_CO</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;selfSheilding&#39;</span><span class="p">][</span><span class="s">&#39;CO&#39;</span><span class="p">][</span><span class="n">indAv</span><span class="p">]</span>
                <span class="n">beta_13CO</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;selfSheilding&#39;</span><span class="p">][</span><span class="s">&#39;13CO&#39;</span><span class="p">][</span><span class="n">indAv</span><span class="p">]</span>
                <span class="n">beta_H2</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;selfSheilding&#39;</span><span class="p">][</span><span class="s">&#39;H2&#39;</span><span class="p">][</span><span class="n">indAv</span><span class="p">]</span>
                <span class="n">abun_use</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;state&#39;</span><span class="p">][</span><span class="s">&#39;abun&#39;</span><span class="p">][:,</span><span class="n">indAv</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Av   used = </span><span class="si">%.4f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">Av_use</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Tgas used = </span><span class="si">%.4f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">gasT_use</span><span class="p">)</span>
                
                <span class="c">#setting the parameters of the gas and the environment at that slab</span>
                <span class="n">chemNet</span><span class="o">.</span><span class="n">set_environment_state</span><span class="p">(</span><span class="n">T</span>           <span class="o">=</span> <span class="n">gasT_use</span><span class="p">,</span> 
                                              <span class="n">zeta</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms_used_in_PDR_models</span><span class="p">[</span><span class="s">&#39;zeta&#39;</span><span class="p">],</span> 
                                              <span class="n">Av</span>          <span class="o">=</span> <span class="n">Av_use</span><span class="p">,</span>
                                              <span class="n">albedo</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms_used_in_PDR_models</span><span class="p">[</span><span class="s">&#39;albedo&#39;</span><span class="p">],</span>
                                              <span class="n">nDens</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;nGas&#39;</span><span class="p">],</span>
                                              <span class="n">G0</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;G0&#39;</span><span class="p">],</span>
                                              <span class="n">Tdust</span>       <span class="o">=</span> <span class="n">dustT_use</span><span class="p">,</span>
                                              <span class="n">metallicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metallicity</span><span class="p">,</span>
                                              <span class="n">PHI_PAH</span>     <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span>
                                              <span class="n">beta_CO</span>     <span class="o">=</span> <span class="n">beta_CO</span><span class="p">,</span>
                                              <span class="n">beta_13CO</span>   <span class="o">=</span> <span class="n">beta_13CO</span><span class="p">,</span>
                                              <span class="n">beta_H2</span>     <span class="o">=</span> <span class="n">beta_H2</span><span class="p">)</span>
                
                <span class="c">#plotting the vertical lines on the gui indicating the positions</span>
                <span class="c">#in the slab used for the chemistry</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">plot_v_lines_used_in_chemnet</span><span class="p">()</span>
                
                <span class="c">#cleaning previously computerd rxn rates and constants (if they were computed)</span>
                <span class="n">chemNet</span><span class="o">.</span><span class="n">set_all_rxn_rates_and_cst_to_none</span><span class="p">()</span>
                 
                <span class="c">#set the abundances at that slab</span>
                <span class="n">chemNet</span><span class="o">.</span><span class="n">set_abundances</span><span class="p">(</span><span class="n">fromArray</span> <span class="o">=</span> <span class="n">abun_use</span><span class="p">)</span> 
                <span class="n">chemNet</span><span class="o">.</span><span class="n">compute_rxn_constants</span><span class="p">()</span>
                <span class="n">chemNet</span><span class="o">.</span><span class="n">compute_rxn_rates</span><span class="p">()</span>

                <span class="n">specStr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;gridsInfo&#39;</span><span class="p">][</span><span class="s">&#39;10&#39;</span><span class="p">][</span><span class="s">&#39;specStr&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;dominat reactions destroyin </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">specStr</span><span class="p">)</span>
                <span class="n">IDs_filtered</span> <span class="o">=</span> <span class="n">chemNet</span><span class="o">.</span><span class="n">filter_reactions</span><span class="p">(</span><span class="n">withReacts</span><span class="o">=</span><span class="n">specStr</span><span class="p">,</span> 
                                                        <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;id type rxn trng cst rate&#39;</span><span class="p">,</span> 
                                                        <span class="n">show</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
                                                        <span class="n">sort</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;dominat reactions producing </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">specStr</span><span class="p">)</span>
                <span class="n">IDs_filtered</span> <span class="o">=</span> <span class="n">chemNet</span><span class="o">.</span><span class="n">filter_reactions</span><span class="p">(</span><span class="n">withProds</span><span class="o">=</span><span class="n">specStr</span><span class="p">,</span> 
                                                        <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;id type rxn trng cst rate&#39;</span><span class="p">,</span> 
                                                        <span class="n">show</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> 
                                                        <span class="n">sort</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;set the environment variable to the chemical netowrk of the mesh.&#39;</span><span class="p">)</span>
            
            
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;use&#39;</span><span class="p">]:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">computeAndSetRadexCurves</span><span class="p">(</span><span class="n">meshObj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="p">,</span>
                                                  <span class="n">Av_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">Av_use</span><span class="p">])</span>

                <span class="n">pyl</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">clickedInAxes</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">tf</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;time elapased after click : </span><span class="si">%f</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tf</span> <span class="o">-</span> <span class="n">ti</span><span class="p">))</span>
                </div>
<div class="viewcode-block" id="meshArxv.computeAndSetRadexCurves"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.computeAndSetRadexCurves">[docs]</a>    <span class="k">def</span> <span class="nf">computeAndSetRadexCurves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">meshObj</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">radex_parms</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">Av_range</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">compute_only</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This is a utilty method (make it a private method), for populating the radex axes</span>
<span class="sd">          with the plots for the specie passed in the global parameter self.parms[&#39;radex&#39;][&#39;specStr&#39;].</span>
<span class="sd">          It takes as a paremeter the :data:`mesh` which will be used for doing the radex computations.</span>
<span class="sd">          </span>
<span class="sd">          if meshObj is not passed, self.mshTmp is used as the pdr mesh object.</span>
<span class="sd">          if Av_range is not passed, the maximum Av is used.</span>
<span class="sd">          if compute_only is passed, nothing is plotted, only the emissions are computed and set</span>
<span class="sd">          to self.radexObj</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">meshObj</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">meshObj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span>
            
        <span class="k">if</span> <span class="n">radex_parms</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">radex_parms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">]</span>

        <span class="c">#getthing the stuff radex needs from the PDR mesh</span>
        <span class="p">(</span><span class="n">gasTRadex</span><span class="p">,</span> <span class="n">nColls</span><span class="p">,</span> <span class="n">colDensThisSpec</span><span class="p">,</span> <span class="n">Av_range_used</span><span class="p">,)</span> <span class="o">=</span> <span class="n">meshObj</span><span class="o">.</span><span class="n">getRadexParameters</span><span class="p">(</span><span class="n">speciesStr</span> <span class="o">=</span> <span class="n">radex_parms</span><span class="p">[</span><span class="s">&#39;specStr&#39;</span><span class="p">],</span> 
                                                                                          <span class="n">threshold</span>  <span class="o">=</span> <span class="n">radex_parms</span><span class="p">[</span><span class="s">&#39;xH2_Min&#39;</span><span class="p">],</span>
                                                                                          <span class="n">Av_range</span>   <span class="o">=</span> <span class="n">Av_range</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">compute_only</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c">#setting the axes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">setupPlot</span><span class="p">(</span><span class="n">nx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">],</span> <span class="n">axs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltRadex</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">set_logger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">)</span>
            <span class="c">#clearing them in case there was anything</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">clearCurves</span><span class="p">()</span>
                            
        <span class="c"># getting the collider densities in the same order of the supplied input spcie string list </span>
        <span class="n">nDensColls</span> <span class="o">=</span> <span class="p">[</span> <span class="n">nColls</span><span class="p">[</span><span class="n">collSpecStr</span><span class="p">]</span> <span class="k">for</span> <span class="n">collSpecStr</span> <span class="ow">in</span> <span class="n">radex_parms</span><span class="p">[</span><span class="s">&#39;collisionPartners&#39;</span><span class="p">]</span> <span class="p">]</span>
        <span class="n">collsStr</span>   <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">radex_parms</span><span class="p">[</span><span class="s">&#39;collisionPartners&#39;</span><span class="p">])</span>
        <span class="c">#print &#39;input coll species&#39;, self.radexParms[&#39;collisionPartners&#39;] </span>
        <span class="c">#print &#39;nColls after putting them in the right order = &#39;, nDensColls</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">setInFileParm</span><span class="p">(</span><span class="s">&#39;specStr&#39;</span><span class="p">,</span> <span class="n">radex_parms</span><span class="p">[</span><span class="s">&#39;specStr&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">setInFileParm</span><span class="p">(</span><span class="s">&#39;tKin&#39;</span><span class="p">,</span> <span class="n">gasTRadex</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">setInFileParm</span><span class="p">(</span><span class="s">&#39;collisionPartners&#39;</span><span class="p">,</span> <span class="n">collsStr</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">setInFileParm</span><span class="p">(</span><span class="s">&#39;nDensCollisionPartners&#39;</span><span class="p">,</span> <span class="n">nDensColls</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">setInFileParm</span><span class="p">(</span><span class="s">&#39;molnDens&#39;</span><span class="p">,</span> <span class="n">colDensThisSpec</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">filterColliders</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">compute_only</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c">#updating the display strings on the gui related to Radex</span>
            <span class="c">#updating the [&#39;radex&#39;][&#39;title1&#39;] and [&#39;radex&#39;][&#39;title2&#39;]</span>
            <span class="c">#title1</span>
            <span class="n">strng</span> <span class="o">=</span> <span class="s">&#39;radex LVG data for species </span><span class="si">%s</span><span class="s">, Av = [</span><span class="si">%.2f</span><span class="s">, </span><span class="si">%.2f</span><span class="s">]&#39;</span> <span class="o">%</span>  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;specStr&#39;</span><span class="p">],</span> <span class="n">Av_range_used</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Av_range_used</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;title1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">strng</span><span class="p">)</span>
            <span class="c">#title2</span>
            <span class="n">strng</span> <span class="o">=</span> <span class="s">&#39;gasT</span><span class="se">\n</span><span class="si">%f</span><span class="se">\n</span><span class="s">N(specie)</span><span class="se">\n</span><span class="si">%e</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">gasTRadex</span><span class="p">,</span> <span class="n">colDensThisSpec</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">specStr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">inFile</span><span class="p">[</span><span class="s">&#39;collisionPartners&#39;</span><span class="p">]):</span>
                <span class="n">strng</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%e</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">specStr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">inFile</span><span class="p">[</span><span class="s">&#39;nDensCollisionPartners&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>                
            <span class="bp">self</span><span class="o">.</span><span class="n">gui</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;title2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="n">strng</span><span class="p">)</span>


        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">inFile</span><span class="p">[</span><span class="s">&#39;collisionPartners&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;not enough colliders&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># writing the parameters to a file (for debugging purposes)</span>
            <span class="c"># this file can be used to re-run radex as standalone</span>
            <span class="n">fName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;path&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;-debug.inp&#39;</span>
            <span class="n">fObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fName</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">fObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">genInputFileContentAsStr</span><span class="p">()</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;input radex file written to </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fName</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;checkOutputIntegrity&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">setDefaultStatus</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">checkInput</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
                <span class="n">radexOutputMakesSense</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c">#running radex (multiple times if necessary) for it to converge for this set of parms     </span>
                <span class="n">status</span><span class="p">,</span> <span class="n">radexOutputMakesSense</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">run_mutiple_trials</span><span class="p">(</span><span class="n">expected_sum_pop_dens</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;popDensSumExpected&#39;</span><span class="p">],</span>
                                                                                 <span class="n">rel_pop_dens_tol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;popDensSumTol&#39;</span><span class="p">],</span> 
                                                                                 <span class="n">change_frac_trial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;changeFracTrial&#39;</span><span class="p">],</span>    
                                                                                 <span class="n">max_trials</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;nMaxTrial&#39;</span><span class="p">])</span>
            
            <span class="c">#plotting only when the radex solution makes sense (pop dens dont add up to </span>
            <span class="c">#what they should be up to a certain tolerence)</span>
            <span class="k">if</span> <span class="n">radexOutputMakesSense</span><span class="p">:</span>
                
                <span class="k">if</span> <span class="n">compute_only</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="c"># plotting the data (even if it does not converge)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">getStatus</span><span class="p">()</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">FLAGS</span><span class="p">[</span><span class="s">&#39;SUCCESS&#39;</span><span class="p">]:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">plotModelInFigureColumn</span><span class="p">(</span><span class="n">allTrans</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;radex&#39;</span><span class="p">][</span><span class="s">&#39;maxDisplayTranistion&#39;</span><span class="p">]),</span>
                                                              <span class="n">inAxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltRadex</span><span class="p">,</span>     
                                                              <span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>                             
                    <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">setLabels</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span><span class="o">.</span><span class="n">print_warnings</span><span class="p">()</span> <span class="c">#printing the warnings</span>
</div>
<div class="viewcode-block" id="meshArxv.clear"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;clears all the bufferes allocated in the instance&quot;&quot;&quot;</span>
        
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">infoAll</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">nDbFiles</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemNet</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltGmSec</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">radexParms</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">grds</span>  
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltRadex</span>
        <span class="n">pyl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="meshArxv.plotCurvesFromMeshes"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.plotCurvesFromMeshes">[docs]</a>    <span class="k">def</span> <span class="nf">plotCurvesFromMeshes</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">inds</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">qx</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">qy</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">qz</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots curves from the meshes in the database on top of each other in the</span>
<span class="sd">          same window. This method inherits all keword argument from pyl.plot()</span>
<span class="sd">          </span>
<span class="sd">          :param list inds: an optional list of the indicies of the meshes in the database. If</span>
<span class="sd">           this is not passed, all the meshes in the database are considered.</span>
<span class="sd">          :param list qx: a list of strings pointing to the quantinity in the mesh dtype to</span>
<span class="sd">            be used as the absissa of the points. </span>
<span class="sd">          :param list qy: same as qx but will be used as the ordinates.  </span>
<span class="sd">          :param list qz: a thrid quantity used to identity each curve (used in the legend)</span>

<span class="sd">          .. warning:: check and test this methods and document it better.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">fig</span> <span class="o">=</span> <span class="n">pyl</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>  <span class="c"># make the figure</span>
        <span class="n">ax</span>  <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>    <span class="c"># make new axes</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">qx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">qy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="n">plts</span>  <span class="o">=</span> <span class="p">()</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">()</span>
        
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">fetchNestedDtypeValue</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">qx</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">fetchNestedDtypeValue</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">qy</span><span class="p">)</span>
            <span class="n">plt</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">qz</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">fetchNestedDtypeValue</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">qz</span><span class="p">)</span>
                <span class="n">plts</span>  <span class="o">=</span> <span class="n">plts</span>  <span class="o">+</span> <span class="p">(</span><span class="n">plt</span><span class="p">,)</span>
                <span class="n">names</span> <span class="o">=</span> <span class="n">names</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span><span class="p">,)</span>
        
        <span class="c">#print plts</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">plts</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span>
        <span class="n">pyl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="meshArxv.plot_3D_grid_points"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.plot_3D_grid_points">[docs]</a>    <span class="k">def</span> <span class="nf">plot_3D_grid_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;plots in 3D the parameters of the meshes in the database. By default</span>
<span class="sd">           the x,y,z coordinates are the log10 of nGas, G0, and gammaMech</span>
<span class="sd">           </span>
<span class="sd">           :param matplotlib.pyplot.figure figure: if this keyword is passed, a new figure is not </span>
<span class="sd">               created and the axes are created in the figure object passed.</span>
<span class="sd">           :param  mpl_toolkits.mplot3d.Axes3D axes: if this keyword is passed, things are plotted</span>
<span class="sd">               in these axes, otherwise new ones are created in the figure.</span>
<span class="sd">           :return: (figure, axes, plt) </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;data of one or more coordinates not set!!.&#39;</span><span class="p">)</span>
         
        <span class="k">if</span> <span class="s">&#39;figure&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">pyl</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;figure&#39;</span><span class="p">]</span> 
            
        <span class="c"># setting the x,y,z coordinate variables</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_grid_axes_quantity_values</span><span class="p">()</span>            
        
        <span class="k">if</span> <span class="s">&#39;axes&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s">&#39;3d&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;axes&#39;</span><span class="p">]</span>
        
        <span class="n">zPlt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span>
        
        <span class="n">plt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="p">,</span> <span class="n">zPlt</span><span class="p">,</span> <span class="s">&#39;o&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ranges&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ranges&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ranges&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ranges&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ranges&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;ranges&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_qx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_qy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_qz</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="n">plt</span><span class="p">)</span>
        
    <span class="c">###############################setter and getters##############################</span></div>
    <span class="k">def</span> <span class="nf">setChemicalNetwork</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chemNet</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chemNet</span> <span class="o">=</span> <span class="n">chemNet</span> 
    <span class="k">def</span> <span class="nf">set_grid_qx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qx</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_qx</span> <span class="o">=</span> <span class="n">qx</span>
    <span class="k">def</span> <span class="nf">set_grid_qy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qy</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_qy</span> <span class="o">=</span> <span class="n">qy</span>
    <span class="k">def</span> <span class="nf">set_grid_qz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qz</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_qz</span> <span class="o">=</span> <span class="n">qz</span>
    <span class="k">def</span> <span class="nf">set_metallicity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metallicity</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metallicity</span> <span class="o">=</span> <span class="n">metallicity</span>

<div class="viewcode-block" id="meshArxv.set_attributes"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.set_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">set_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set values of attributes from provided keywords</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="s">&#39;grid_qx&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_grid_qx</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;grid_qx&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;grid_qy&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_grid_qy</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;grid_qy&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;grid_qz&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_grid_qz</span><span class="p">(</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;grid_qz&#39;</span><span class="p">]</span> <span class="p">)</span>
        </div>
<div class="viewcode-block" id="meshArxv.set_default_attributes"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.set_default_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">set_default_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;sets the default values of the attributes if they are not set</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_qx</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_grid_qx</span><span class="p">(</span> <span class="p">[</span><span class="s">&#39;hdr&#39;</span><span class="p">,</span> <span class="s">&#39;nGas&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_qy</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_grid_qy</span><span class="p">(</span> <span class="p">[</span><span class="s">&#39;hdr&#39;</span><span class="p">,</span> <span class="s">&#39;G0&#39;</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_qz</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_grid_qz</span><span class="p">(</span> <span class="p">[</span><span class="s">&#39;hdr&#39;</span><span class="p">,</span> <span class="s">&#39;gammaMech&#39;</span><span class="p">]</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="meshArxv.set_grid_axes_quantity_values"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.set_grid_axes_quantity_values">[docs]</a>    <span class="k">def</span> <span class="nf">set_grid_axes_quantity_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assigns the values of self.grid_x,y,z from self.grid_qx,qy,qz. The values</span>
<span class="sd">           are extracted from all the meshes in the database.</span>
<span class="sd">        </span>
<span class="sd">           :param bool relativeGmech: if this is set, the z quantity data is set as the</span>
<span class="sd">            ratio of mechanicalHeating of the mesehs to the surface heating when the</span>
<span class="sd">            mechanical heating is zero. If this is set, the keyword &#39;referenceDatabase&#39;</span>
<span class="sd">            sould be provided. It is assumed that the reference database has exact same</span>
<span class="sd">            parameters as the current one. It is assumed that the minimum gmech in </span>
<span class="sd">            reference database is low enough to be assumed to be zero. An interpolation</span>
<span class="sd">            function is constructed which picks the lowest gMech of the reference</span>
<span class="sd">            database. This keyword cuases self.grid_qz to be set to </span>
<span class="sd">            &#39;gMech/gSurface(gMech=0)&#39;</span>

<span class="sd">           :param string referenceDatabasePath: a string containing the path of the </span>
<span class="sd">             reference database.</span>
<span class="sd">           :param float64 min_gMech: If this is present, the gMech of the reference models</span>
<span class="sd">             used would be this values instead of the minimum.</span>
<span class="sd">         </span>
<span class="sd">           .. note:: by default, the log of the quantities from the meshes are used. Only</span>
<span class="sd">              when the relative keyword is present, the value of the heating ratios is </span>
<span class="sd">              set, and NOT the log of the heating ratios. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="s">&#39;relativeGmech&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="s">&#39;grid_qz&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Either relativeGmech or grid_qz can be passed, not both&#39;</span><span class="p">)</span> 
        
        <span class="c">#making sure self.qx,y,z are set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_attributes</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_default_attributes</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getQuantityFromAllMeshes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_qx</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getQuantityFromAllMeshes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_qy</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            
            <span class="c"># check whether we need to set the z quantity as the ration of heating rates</span>
            <span class="k">try</span><span class="p">:</span> 
                <span class="n">setRelativeGmech</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;relativeGmech&#39;</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">setRelativeGmech</span> <span class="o">=</span> <span class="bp">False</span>                
                        
            <span class="c"># if relativeGmech is present AND it is True</span>
            <span class="k">if</span> <span class="n">setRelativeGmech</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            
                <span class="c">#setting the path of the reference database</span>
                <span class="k">if</span> <span class="s">&#39;referenceDatabasePath&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="n">referenceDbDirPath</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s">&#39;referenceDatabasePath&#39;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s">&#39;runDirPath2&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms_used_in_PDR_models</span><span class="p">:</span>
                    <span class="n">referenceDbDirPath</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">parms_used_in_PDR_models</span><span class="p">[</span><span class="s">&#39;runDirPath2&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;&quot;&quot;missing the path of the reference database. Either &quot;referenceDatabasePath&quot;</span>
<span class="s">                                        should be passed as a keyword or self.parms_used_in_PDR_models[&#39;runDirPath2&#39;]</span>
<span class="s">                                        should be set.&quot;&quot;&quot;</span><span class="p">)</span>

                <span class="c">#computing (for the mesh points in the current database) the ratio of </span>
                <span class="c">#the mechanical heating to the surface heating when gmech = 0</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">set_grid_qz</span><span class="p">([</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;gMech/gSurface(gMech=0)&#39;</span><span class="p">])</span>
                
                <span class="c"># reading the reference archive</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;setting up the reference archive&#39;</span><span class="p">)</span>
                <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
                <span class="n">arxvRef</span> <span class="o">=</span> <span class="n">meshArxv</span><span class="p">(</span><span class="n">dirPath</span> <span class="o">=</span> <span class="n">referenceDbDirPath</span><span class="p">,</span> <span class="n">readDb</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;time reading </span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span><span class="p">))</span>
                
                <span class="c">#finding the minimum gMech of the reference database, and constructing</span>
                <span class="c">#an interpolation function which returns the surface heating corresponding</span>
                <span class="c">#to that mechanical heating rate.</span>
                <span class="k">if</span> <span class="s">&#39;min_gMech&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">:</span>
                    <span class="n">min_gMech</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parms</span><span class="p">[</span><span class="s">&#39;min_gMech&#39;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">min_gMech</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> 
                                                <span class="p">[</span><span class="n">mesh</span><span class="p">[</span><span class="s">&#39;hdr&#39;</span><span class="p">][</span><span class="s">&#39;gammaMech&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">mesh</span> <span class="ow">in</span> <span class="n">arxvRef</span><span class="o">.</span><span class="n">meshes</span><span class="p">]</span> 
                                                <span class="p">)</span>
                                       <span class="p">)</span>
                
                <span class="n">gMechZero</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="c">#setting the values of gMech where the surface heating will be computed</span>
                <span class="n">gMechZero</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">min_gMech</span><span class="p">)</span>
                
                <span class="c">#getting the surface heating that the models in the current would have</span>
                <span class="c">#from the reference database which has gmech = 0</span>
                <span class="n">arxvRef</span><span class="o">.</span><span class="n">set_grid_qx</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_qx</span> <span class="p">)</span>
                <span class="n">arxvRef</span><span class="o">.</span><span class="n">set_grid_qy</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_qy</span> <span class="p">)</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">arxvRef</span><span class="o">.</span><span class="n">construct3DInterpolationFunction</span><span class="p">(</span><span class="n">quantity</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;therm&#39;</span><span class="p">,</span> <span class="s">&#39;heating&#39;</span><span class="p">],</span> 
                                                             <span class="n">slabIdx</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> 
                                                             <span class="n">log10</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                                                             <span class="n">grid_qz</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;hdr&#39;</span><span class="p">,</span><span class="s">&#39;gammaMech&#39;</span><span class="p">])</span>
                <span class="n">dataNew</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="p">,</span> <span class="n">gMechZero</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">T</span>
                
                <span class="c"># the surface heating that the models in the current would have if the </span>
                <span class="c"># mechanical heating were zero</span>
                <span class="n">gammaSurf</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">dataNew</span><span class="p">)</span> 

                <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getQuantityFromAllMeshes</span><span class="p">(</span> <span class="p">[</span><span class="s">&#39;hdr&#39;</span><span class="p">,</span> <span class="s">&#39;gammaMech&#39;</span><span class="p">])</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">10.0</span><span class="o">**</span><span class="n">z</span> <span class="o">/</span> <span class="mf">10.0</span><span class="o">**</span><span class="n">gammaSurf</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># just use gMech as the 3rd axis</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">getQuantityFromAllMeshes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_qz</span><span class="p">)</span> <span class="p">)</span>
    </div>
<div class="viewcode-block" id="meshArxv.setupLogger"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.setupLogger">[docs]</a>    <span class="k">def</span> <span class="nf">setupLogger</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;sets up the logger which will prepend info about the printed stuff. Assignes a value to self.logger.&quot;&quot;&quot;</span>
        
        <span class="c"># setting up the logger                                                                                                                                                                                                              </span>
        <span class="c"># create logger                                                                                                                                                                                                                      </span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;simple_example&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">logger</span><span class="o">.</span><span class="n">handlers</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

            <span class="c"># create console handler and set level to debug                                                                                                                                                                                      </span>
            <span class="n">ch</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="p">)</span>  <span class="c"># setting the stream to stdout                                                                                                                                                             </span>
            <span class="n">ch</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
    
            <span class="c"># create formatter                                                                                                                                                                                                                   </span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s">&#39;[</span><span class="si">%(asctime)s</span><span class="s"> </span><span class="si">%(funcName)s</span><span class="s">() </span><span class="si">%(filename)s</span><span class="s">:</span><span class="si">%(lineno)s</span><span class="s">] </span><span class="si">%(message)s</span><span class="s">&#39;</span><span class="p">)</span> <span class="c"># this was the original in the example                                                                              </span>
    
            <span class="c"># add formatter to ch                                                                                                                                                                                                                </span>
            <span class="n">ch</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
    
            <span class="c"># add ch to logger                                                                                                                                                                                                                   </span>
            <span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span>
    </div>
<div class="viewcode-block" id="meshArxv.writeRadexDbAscii"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.writeRadexDbAscii">[docs]</a>    <span class="k">def</span> <span class="nf">writeRadexDbAscii</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;a utlity method which can be used to output stuff to an ascii file. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">fileName</span> <span class="o">=</span> <span class="s">&#39;/home/mher/ism/marissa-0.csv&#39;</span>
        
        <span class="n">fObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nMeshes</span><span class="p">):</span>
                
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshesRadex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    
                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                
                <span class="n">strng</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%f</span><span class="s">,</span><span class="si">%f</span><span class="s">,</span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">trans</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshesRadex</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">strng</span> <span class="o">+=</span> <span class="s">&#39;,</span><span class="si">%s</span><span class="s">-</span><span class="si">%s</span><span class="s">,</span><span class="si">%e</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">trans</span><span class="p">[</span><span class="s">&#39;upper&#39;</span><span class="p">],</span><span class="n">trans</span><span class="p">[</span><span class="s">&#39;lower&#39;</span><span class="p">],</span><span class="n">trans</span><span class="p">[</span><span class="s">&#39;fluxcgs&#39;</span><span class="p">])</span>
                <span class="n">strng</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="k">if</span> <span class="n">z</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">29.5</span><span class="p">:</span>
                    <span class="k">print</span> <span class="n">strng</span>
                    <span class="n">fObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">strng</span><span class="p">)</span>
                <span class="c">#v = self.meshesRadex[i][transitionIdx][quantity]</span>
                

        <span class="n">fObj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c">#writing some of the output of the DB in to an ascii file</span>
        </div>
<div class="viewcode-block" id="meshArxv.getUnique_grid_z_sections"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.getUnique_grid_z_sections">[docs]</a>    <span class="k">def</span> <span class="nf">getUnique_grid_z_sections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">relDiff</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns the unique section in z up to a relative difference of relDiff&quot;&quot;&quot;</span>
        
        <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span>
        
        <span class="n">sections</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span> <span class="n">z</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">mn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
            <span class="c">#print &#39;min = &#39;, mn, 10.0**mn</span>
            <span class="k">if</span> <span class="n">mn</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="n">z</span> <span class="o">!=</span> <span class="n">mn</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span> <span class="nb">abs</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">z</span><span class="o">/</span><span class="n">mn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">relDiff</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">inds</span><span class="p">]</span>
            <span class="n">sections</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mn</span><span class="p">)</span>
    
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sections</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="meshArxv.do_something_for_all_meshes"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.do_something_for_all_meshes">[docs]</a>    <span class="k">def</span> <span class="nf">do_something_for_all_meshes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A template method which loops over all meshes and gets/computes something </span>
<span class="sd">        from each mesh.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">fName</span> <span class="o">=</span> <span class="s">&#39;/home/mher/ism/marissa/CO-ladder.out&#39;</span>
        <span class="n">fObj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fName</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
        
        <span class="c">#a temporary object used to calculate stuff from a pdr mesh object</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">mesh</span><span class="p">(</span><span class="n">chemNet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">chemNet</span><span class="p">,</span> <span class="n">metallicity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metallicity</span><span class="p">)</span>
                        
        <span class="c">#--------------------------looping over all the meshes------------------</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pdrData</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="p">):</span>
            
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="c"># model parms </span>
            <span class="n">pdrMeshData</span> <span class="o">=</span> <span class="n">pdrData</span>                                    <span class="c"># pdf mesh data</span>
            <span class="n">rdxMeshData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshesRadex</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>                        <span class="c"># radex data</span>
            
            <span class="n">m</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span> <span class="n">pdrMeshData</span> <span class="p">)</span>
            <span class="n">dxSlabs</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">compute_dx</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">z</span> <span class="o">==</span> <span class="o">-</span><span class="mi">10</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;mesh x,y,z = </span><span class="si">%.2f</span><span class="s">, </span><span class="si">%.2f</span><span class="s">, </span><span class="si">%.2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">),</span>
                
                <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                #----------------dumping the total cooling--------------------</span>
<span class="sd">                quantity = [&#39;therm&#39;,&#39;heating&#39;]</span>
<span class="sd">                v = (1.0/(2.0*np.pi))*m.compute_integrated_quantity(quantity)</span>
<span class="sd">                fObj.write(&#39;%d %.2f %.2f %.5e\n&#39; % (i, x, y, v))</span>
<span class="sd">                #----------------done dumping the total cooling---------------</span>
<span class="sd">                &quot;&quot;&quot;</span>
                
                <span class="c">#----------------dumping the radex CO lines--------------------</span>
                <span class="n">fObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%d</span><span class="s"> </span><span class="si">%.2f</span><span class="s"> </span><span class="si">%.2f</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">rdxMeshData</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">trans</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshesRadex</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">fObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.5e</span><span class="s"> </span><span class="si">%.5e</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">trans</span><span class="p">[</span><span class="s">&#39;pop_up&#39;</span><span class="p">],</span> <span class="n">trans</span><span class="p">[</span><span class="s">&#39;fluxcgs&#39;</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;nan&#39;</span><span class="p">)</span>
                <span class="n">fObj</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="c">#----------------done dumping the total cooling---------------</span>
                
                
                
        <span class="c">#--------------------------done looping over the meshes---------------       </span>
                
        <span class="n">fObj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&#39;wrote the file </span><span class="si">%s</span><span class="s">&#39;</span>
                </div>
<div class="viewcode-block" id="meshArxv.write_pdr_code_guess_database"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.write_pdr_code_guess_database">[docs]</a>    <span class="k">def</span> <span class="nf">write_pdr_code_guess_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;writes the guess database that is used by the pdr code. See </span>
<span class="sd">        the struct &#39;database&#39; in oneSided/src/vars.h.</span>
<span class="sd">        </span>
<span class="sd">        Steps involved in preparing the data before calling this method:</span>
<span class="sd">        </span>
<span class="sd">          - collect a bunch of mesh files in simulation folder</span>
<span class="sd">          - construct the database by running : constructReadArchive.py</span>
<span class="sd">          - then call this method and save the file to be used later </span>
<span class="sd">          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">amuse.community.pdr.pyUtils.guess_db</span> <span class="kn">import</span> <span class="n">guess_db</span>
        
        <span class="n">pdrGuessDb</span> <span class="o">=</span> <span class="n">guess_db</span><span class="p">(</span> <span class="n">path</span> <span class="o">=</span> <span class="n">path</span> <span class="p">)</span>

        <span class="c"># setting the x,y,z coordinate variables</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_grid_axes_quantity_values</span><span class="p">()</span>            

        <span class="c">#getting the data from all the meshes</span>
        <span class="c">#------------------------------------</span>
        <span class="n">logDens</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span>
        <span class="n">logG0</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span>
        <span class="n">logGammaM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span>
        <span class="n">Teq</span>       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getQuantityFromAllMeshes</span><span class="p">(</span><span class="n">quantity</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;state&#39;</span><span class="p">,</span><span class="s">&#39;gasT&#39;</span><span class="p">],</span> <span class="n">slabIdx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c">#collecting the abundance (taking the transpose to make it compatible with </span>
        <span class="c">#the shape acceptable by the &#39;guess&#39; class</span>
        <span class="n">abun</span>      <span class="o">=</span> <span class="p">[</span> <span class="n">m</span><span class="p">[</span><span class="s">&#39;state&#39;</span><span class="p">][</span><span class="s">&#39;abun&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="p">],</span>
        <span class="n">abun</span>      <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">abun</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="c">#------------------------------------</span>
        
        <span class="c">#print pdrGuessDb.get_path()</span>
        <span class="n">pdrGuessDb</span><span class="o">.</span><span class="n">set_db_data</span><span class="p">(</span><span class="n">logDens</span><span class="p">,</span> <span class="n">logG0</span><span class="p">,</span> <span class="n">logGammaM</span><span class="p">,</span> <span class="n">Teq</span><span class="p">,</span> <span class="n">abun</span><span class="p">)</span>
        <span class="n">pdrGuessDb</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>    
    </div>
<div class="viewcode-block" id="meshArxv.get_mesh_index"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.get_mesh_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_mesh_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the index of the mesh in the x,y,z parmaerter coordinate lests self.grid_x, self.grid_y, self.grid_z</span>
<span class="sd">        which are closest to the input x,y,z.&quot;&quot;&quot;</span>
        
        <span class="n">l2Distance</span>  <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span>
        <span class="n">indMin</span> <span class="o">=</span> <span class="n">l2Distance</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
    
        <span class="k">return</span> <span class="n">indMin</span>
    </div>
<div class="viewcode-block" id="meshArxv.get_mesh_data"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.get_mesh_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_mesh_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the data (of dtype :data:`mesh`.data) of the pdr mesh in the x,y,z parmaerter </span>
<span class="sd">        coordinate lests self.grid_x, self.grid_y, self.grid_z which are closest to the input x,y,z.&quot;&quot;&quot;</span>
        
        <span class="n">ind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mesh_index</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meshes</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> 
        <span class="k">return</span>  <span class="bp">self</span><span class="o">.</span><span class="n">mshTmp</span>
    </div>
<div class="viewcode-block" id="meshArxv.grid_interpolator"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.grid_interpolator">[docs]</a>    <span class="k">def</span> <span class="nf">grid_interpolator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_gas</span><span class="p">,</span> <span class="n">fuv_heating</span><span class="p">,</span> <span class="n">g_mech</span><span class="p">,</span>
                          <span class="n">quantity</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">slabIdx</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns interpolated vlaues for input quantities. The input</span>
<span class="sd">        values are gas density, fuv heating and mechanical heating as</span>
<span class="sd">        numpy arrays with amuse units.  These are converted to the </span>
<span class="sd">        same units as the PDR meshes.  An interpolation function is </span>
<span class="sd">        constructed and the interpolation is done for a quantity pointing</span>
<span class="sd">        to the dtype of data of a mesh.&quot;&quot;&quot;</span>
        
        <span class="kn">from</span> <span class="nn">amuse.units</span> <span class="kn">import</span> <span class="n">units</span>

        <span class="c">#----------------------------------------------------------------</span>
        <span class="c"># converting the quantities to units compatible with PDR models</span>
        <span class="c"># getting the quantities as numpy arrays</span>
        <span class="c">#----------------------------------------------------------------</span>
        <span class="c">#converting gas density to cgs</span>
        <span class="n">meanmwt</span><span class="o">=</span><span class="mf">1.3</span><span class="o">|</span><span class="n">units</span><span class="o">.</span><span class="n">amu</span>
        <span class="n">n_gas_cgs</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_gas</span><span class="o">/</span><span class="n">meanmwt</span><span class="p">)</span><span class="o">.</span><span class="n">value_in</span><span class="p">(</span> <span class="n">units</span><span class="o">.</span><span class="n">cm</span> <span class="o">**-</span><span class="mi">3</span> <span class="p">)</span>
        
        <span class="c">#converting the G0 to correct units</span>
        <span class="n">G0</span> <span class="o">=</span> <span class="mf">6.54</span><span class="o">*</span><span class="n">fuv_heating</span><span class="o">.</span><span class="n">value_in</span><span class="p">(</span> <span class="n">units</span><span class="o">.</span><span class="n">none</span> <span class="p">)</span>
        
        <span class="c">#converting the mechanical heating to the correct unit</span>
        <span class="c">#from m2 / s3 (Inti Units) to  erg / (cm^3 s)</span>
        <span class="n">g_mech</span> <span class="o">=</span> <span class="n">g_mech</span><span class="o">.</span><span class="n">as_quantity_in</span><span class="p">(</span> <span class="n">units</span><span class="o">.</span><span class="n">erg</span> <span class="o">/</span> <span class="p">(</span><span class="n">units</span><span class="o">.</span><span class="n">g</span> <span class="o">*</span> <span class="n">units</span><span class="o">.</span><span class="n">s</span> <span class="p">)</span> <span class="p">)</span>
        <span class="c"># converting the mechanical heating rate from per unit mass (of H gas)     </span>
        <span class="c"># to per unit volume (see notesISM.odt)</span>
        <span class="n">g_mech</span> <span class="o">=</span> <span class="n">g_mech</span><span class="o">.</span><span class="n">value_in</span><span class="p">(</span> <span class="n">g_mech</span><span class="o">.</span><span class="n">unit</span> <span class="p">)</span> <span class="c"># gMech in erg / (g s )</span>
        <span class="n">g_mech</span> <span class="o">=</span> <span class="n">g_mech</span> <span class="o">*</span> <span class="mf">1.6474e-24</span> <span class="o">*</span> <span class="n">n_gas_cgs</span> <span class="c"># gMech in erg / (cm^3 s) </span>

        <span class="c">#talking the log of the input quantities at which the interpolated</span>
        <span class="c">#quantities will be returned</span>
        <span class="n">lx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">n_gas_cgs</span><span class="p">)</span>
        <span class="n">ly</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">G0</span><span class="p">)</span>
        <span class="n">lz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">g_mech</span><span class="p">)</span>
        <span class="c">#-----------------------done converting units----------------------</span>
        
        <span class="c">#-----------------------generate the interpolation function--------</span>
        <span class="n">fInterp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">construct3DInterpolationFunction</span><span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">slabIdx</span><span class="p">)</span>

        <span class="c">#picking the SPH particles which are within the parametrer space</span>
        <span class="c">#of the PDR grids </span>
        <span class="n">lx</span> <span class="o">=</span> <span class="n">lx</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_x</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">ly</span> <span class="o">=</span> <span class="n">ly</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_y</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="n">lz</span> <span class="o">=</span> <span class="n">lz</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_z</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        
        <span class="n">dataNew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">[</span><span class="n">lx</span><span class="p">,</span> <span class="n">ly</span><span class="p">,</span> <span class="n">lz</span><span class="p">]</span> <span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">qInterp</span> <span class="o">=</span> <span class="n">fInterp</span><span class="p">(</span><span class="n">dataNew</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">qInterp</span>
    </div>
<div class="viewcode-block" id="meshArxv.setup_default_radex_instance"><a class="viewcode-back" href="../index.html#meshUtils.meshArxv.setup_default_radex_instance">[docs]</a>    <span class="k">def</span> <span class="nf">setup_default_radex_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radex_parms</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;sets up an instance of the object &#39;radex&#39; to after using</span>
<span class="sd">           the parameters from radex_parms and setting &#39;tKin&#39;, &#39;nDensCollisionPartners&#39;</span>
<span class="sd">           and &#39;molnDens&#39; as None. Also sets the attribute self.radexObj</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#making the instance            </span>
        <span class="n">radexObj</span> <span class="o">=</span> <span class="n">radex</span><span class="p">(</span><span class="n">radex_parms</span><span class="p">[</span><span class="s">&#39;path&#39;</span><span class="p">],</span> <span class="n">radex_parms</span><span class="p">[</span><span class="s">&#39;molDataDirPath&#39;</span><span class="p">])</span>
        <span class="c">#setting some default radex paraemeters</span>
        <span class="n">inFile</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;specStr&#39;</span>                <span class="p">:</span> <span class="n">radex_parms</span><span class="p">[</span><span class="s">&#39;specStr&#39;</span><span class="p">],</span>
                  <span class="s">&#39;outPath&#39;</span>                <span class="p">:</span> <span class="s">&#39;foo&#39;</span> <span class="p">,</span>
                  <span class="s">&#39;freqRange&#39;</span>              <span class="p">:</span> <span class="n">radex_parms</span><span class="p">[</span><span class="s">&#39;freqRange&#39;</span><span class="p">],</span>
                  <span class="s">&#39;tKin&#39;</span>                   <span class="p">:</span> <span class="bp">None</span>  <span class="p">,</span>  <span class="c"># depending on the model</span>
                  <span class="s">&#39;collisionPartners&#39;</span>      <span class="p">:</span> <span class="n">radex_parms</span><span class="p">[</span><span class="s">&#39;collisionPartners&#39;</span><span class="p">],</span>
                  <span class="s">&#39;nDensCollisionPartners&#39;</span> <span class="p">:</span> <span class="bp">None</span>  <span class="p">,</span>  <span class="c"># depending on the model</span>
                  <span class="s">&#39;tBack&#39;</span>                  <span class="p">:</span> <span class="n">radex_parms</span><span class="p">[</span><span class="s">&#39;tBack&#39;</span><span class="p">],</span>  <span class="c"># fixed</span>
                  <span class="s">&#39;molnDens&#39;</span>               <span class="p">:</span> <span class="bp">None</span>  <span class="p">,</span>  <span class="c"># depending on the model</span>
                  <span class="s">&#39;lineWidth&#39;</span>              <span class="p">:</span> <span class="n">radex_parms</span><span class="p">[</span><span class="s">&#39;lineWidth&#39;</span><span class="p">],</span>  <span class="c"># fixed</span>
                  <span class="s">&#39;runAnother&#39;</span>             <span class="p">:</span> <span class="mi">1</span>     <span class="p">}</span>
        <span class="n">radexObj</span><span class="o">.</span><span class="n">setInFile</span><span class="p">(</span> <span class="n">inFile</span> <span class="p">)</span>
        <span class="n">radexObj</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">radexObj</span> <span class="o">=</span> <span class="n">radexObj</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">ismcpak 0.0.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Mher Kazandjian.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>